<!doctype html><html lang=en dir=ltr>
<head prefix="og: http://ogp.me/ns#">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>IO 模型详解 – dotleo's blog</title>
<script defer src=/js/fuse.min.32195737929df2c8096e855a5789cbb3f1331224d9169e8705493e7008f47df8.js></script>
<script src=/js/enquire.min.dfb99dee1e029d51d6cfb672d847929890b1585402de17f5ed092edd72a688b4.js></script>
<script defer src=/js/lazysizes.min.fb649fcae62177dfe63e67081ddceb830b5ce1f05a4184e9bbb7d87ac4b8f4e5.js></script>
<script defer src=/js/helper/getParents.min.ccd45f158c1b17849307ba913a72beac239c410f2b6e648496a79842da84e55b.js></script>
<script defer src=/js/helper/fadeinout.min.1d13d3e810c3940e80cbba6216a1c76fbf42b5431fc83537ea6997863802362b.js></script>
<script defer src=/js/helper/closest.min.js></script>
<script>"use strict";window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),String.prototype.includes||(String.prototype.includes=function(b,a){'use strict';if(b instanceof RegExp)throw TypeError('first argument must not be a RegExp');return a===void 0&&(a=0),this.indexOf(b,a)!==-1}),Document.prototype.append=Element.prototype.append=function(){this.appendChild(_mutation(arguments))};function _mutation(a){if(!a.length)throw new Error('DOM Exception 8');if(a.length===1)return typeof a[0]=='string'?document.createTextNode(a[0]):a[0];for(var c=document.createDocumentFragment(),e=a.length,d=-1,b;++d<e;)b=a[d],c.appendChild(typeof b=='string'?document.createTextNode(b):b);return c}String.prototype.startsWith||(String.prototype.startsWith=function(b,a){return a=a||0,this.indexOf(b,a)===a}),document.addEventListener('DOMContentLoaded',function(){var z=document.querySelector('.navbar__burger'),J,F,G,N,U,f,d,V,r,ae,Z,Q,o,g,y,k,b,s,t,P,O,e,C,h,D,B,ai,A,aj,at,ar,ab,aq,E,ap,ao,ah,an,i,j,c,am,S,T,ak,w,W,X,ag,x,n,Y,q,av,au,a,aw,R,m,L,K,I,v,p,u;z?z.addEventListener('click',function(c){var a=document.querySelector('.navbarm__collapse'),b;a&&(b=a.getAttribute('data-open'),b==='true'?(a.setAttribute('data-open','false'),a.style.maxHeight=0,z.classList.remove('is-active')):(a.setAttribute('data-open','true'),a.style.maxHeight=a.scrollHeight+"px",z.classList.add('is-active')))}):null,J=document.querySelectorAll('.single__contents > table');for(let a=0;a<J.length;a++)F=J[a],G=document.createElement('div'),G.className='table-wrapper',F.parentElement.replaceChild(G,F),G.appendChild(F);N=document.querySelectorAll('.footnote-ref'),U=document.querySelectorAll('.footnote-backref'),N?N.forEach(function(a,c){a.onmouseenter=function(){b.classList.contains('scrolling')&&b.classList.remove('scrolling')},a.onmouseleave=function(){b.classList.contains('scrolling')||setTimeout(function(){b.classList.add('scrolling')},100)},a.onclick=function(){b.classList.contains('scrolling')||(b.classList.remove('navbar--show'),b.classList.remove('navbar--hide'),b.classList.add('navbar--hide'))}}):null,U?U.forEach(function(a,c){a.onmouseenter=function(){b.classList.contains('scrolling')&&b.classList.remove('scrolling')},a.onmouseleave=function(){b.classList.contains('scrolling')||setTimeout(function(){b.classList.add('scrolling')},100)},a.onclick=function(){b.classList.contains('scrolling')||(b.classList.remove('navbar--show'),b.classList.remove('navbar--hide'),b.classList.add('navbar--hide'))}}):null,f=document.querySelector('.summary__container'),d=document.querySelector('.search-result'),V=document.querySelector('.search-result__close'),V?V.addEventListener('click',function(a){d.setAttribute('data-display','none'),f.setAttribute('data-display','block')}):null,document.querySelectorAll('.tab')?document.querySelectorAll('.tab').forEach(function(a,d){var e=a.getAttribute('id'),f=a,b=a.querySelectorAll('.tab__link'),c=a.querySelectorAll('.tab__content'),g=[];b&&b.length>0?b.forEach(function(b,d,a){b.onclick=function(e){for(var b=0;b<a.length;b++)d===parseInt(b,10)?a[b].classList.contains('active')||(a[b].classList.add('active'),c[b].style.display='block'):(a[b].classList.remove('active'),c[b].style.display='none')}}):null}):null,document.querySelectorAll('.codetab')?document.querySelectorAll('.codetab').forEach(function(a,d){var e=a.getAttribute('id'),f=a,b=a.querySelectorAll('.codetab__link'),c=a.querySelectorAll('.codetab__content'),g=[];b&&b.length>0?b.forEach(function(b,d,a){b.onclick=function(e){for(var b=0;b<a.length;b++)d===parseInt(b,10)?a[b].classList.contains('active')||(a[b].classList.add('active'),c[b].style.display='block'):(a[b].classList.remove('active'),c[b].style.display='none')}}):null}):null,r=document.getElementById("gtt"),r.style.display="none",r.addEventListener('click',function(){window.document.documentMode?document.documentElement.scrollTop=0:af(250)});function af(a){var b=-window.scrollY/(a/15),c=setInterval(function(){window.scrollY!=0?window.scrollBy(0,b):clearInterval(c)},15)}ae=function(){document.body.scrollTop>250||document.documentElement.scrollTop>250?r.style.display="block":r.style.display="none"},Z=document.querySelectorAll('.expand__button');for(let a=0;a<Z.length;a++)Z[a].addEventListener("click",function(){var a=this.nextElementSibling;a.style.maxHeight?(a.style.maxHeight=null,this.querySelector('svg').classList.add('expand-icon__right'),this.querySelector('svg').classList.remove('expand-icon__down')):(a.style.maxHeight=a.scrollHeight+"px",this.querySelector('svg').classList.remove('expand-icon__right'),this.querySelector('svg').classList.add('expand-icon__down'))});Q=window.pageYOffset||document.documentElement.scrollTop,o=document.querySelector('.toc'),g=o?o.querySelector('#TableOfContents'):null,y=document.getElementById('toggle-toc'),k=document.querySelector('.single__contents'),b=document.querySelector('.navbar'),s=document.querySelector('.toc__flexbox'),t=document.querySelector('.toc__flexbox--outer'),P=document.querySelectorAll('.expand__content'),O=document.querySelectorAll('.box'),e=null,C=JSON.parse("true"),h=JSON.parse('["h2","h3","h4"]'),h?h=h.toString():h="h1, h2, h3, h4, h5, h6",k&&k.querySelectorAll(".tab")?k.querySelectorAll(".tab").forEach(function(a){a.querySelectorAll(h).forEach(function(a){e=Array.isArray(e)?e.concat(a.getAttribute('id')):[a.getAttribute('id')]})}):null,P?P.forEach(function(a){a.querySelectorAll(h).forEach(function(a){e=Array.isArray(e)?e.concat(a.getAttribute('id')):[a.getAttribute('id')]})}):null,O?O.forEach(function(a){a.querySelectorAll(h).forEach(function(a){e=Array.isArray(e)?e.concat(a.getAttribute('id')):[a.getAttribute('id')]})}):null,window.onscroll=function(){ae();var a=window.pageYOffset||document.documentElement.scrollTop;if(a>Q){if(a<250?r.style.display="none":r.style.display="block",a<45)return null;b.classList.contains('scrolling')&&(b.classList.contains('navbar--hide')?b.classList.contains('navbar--show')&&b.classList.remove('navbar--show'):b.classList.add('navbar--hide')),k&&(k.querySelectorAll(h).length>0?k.querySelectorAll(h).forEach(function(c){var b,a;if(y&&!y.checked)return null;if(e&&e.includes(c.getAttribute('id')))return null;document.documentElement.scrollTop>=c.offsetTop&&g&&(b=c.getAttribute('id'),o.querySelectorAll('a').forEach(function(a){a.classList.remove('active')}),o.querySelector('a[href="#'+b+'"]')?o.querySelector('a[href="#'+b+'"]').classList.add('active'):null,!1===C||(g.querySelectorAll('ul')?g.querySelectorAll('ul').forEach(function(a){a.querySelectorAll('li').forEach(function(a){a.querySelectorAll('ul').forEach(function(a){a.style.display='none'})})}):null),a=g.querySelector("[href='#"+b+"']"),a&&a.nextElementSibling&&(a.nextElementSibling.style.display='block'),getParents(a,'ul')?getParents(a,'ul').forEach(function(a){a.style.display='block'}):null)}):(s&&(s.setAttribute('data-position',''),s.classList.contains('hide')||s.classList.add('hide')),t&&(t.setAttribute('data-position',''),t.classList.contains('hide')||t.classList.add('hide'))))}else a<250&&(r.style.display="none"),b.classList.contains('scrolling')&&(b.classList.contains('navbar--hide')?b.classList.remove('navbar--hide'):b.classList.contains('navbar--show')||b.classList.add('navbar--show')),k&&(k.querySelectorAll(h).length>0?k.querySelectorAll(h).forEach(function(c){var b,a;if(y&&!y.checked)return null;if(e&&e.includes(c.getAttribute('id')))return null;document.documentElement.scrollTop>=c.offsetTop&&g&&(b=c.getAttribute('id'),o.querySelectorAll('a').forEach(function(a){a.classList.remove('active')}),o.querySelector('a[href="#'+b+'"]')?o.querySelector('a[href="#'+b+'"]').classList.add('active'):null,!1===C||(g.querySelectorAll('ul')?g.querySelectorAll('ul').forEach(function(a){a.querySelectorAll('li').forEach(function(a){a.querySelectorAll('ul').forEach(function(a){a.style.display='none'})})}):null),a=g.querySelector("[href='#"+b+"']"),a&&a.nextElementSibling&&(a.nextElementSibling.style.display='block'),getParents(a,'ul')?getParents(a,'ul').forEach(function(a){a.style.display='block'}):null)}):(s&&!s.classList.contains('hide')&&s.classList.add('hide'),t&&!t.classList.contains('hide')&&t.classList.add('hide'))),g&&document.documentElement.scrollTop<250&&(!1===C||(g.querySelector('ul')?g.querySelector('ul').querySelectorAll('li').forEach(function(a){a.querySelectorAll('ul').forEach(function(a){a.style.display='none'})}):null));Q=a<=0?0:a},D=localStorage.getItem('theme'),B=document.getElementById('root'),ai=document.querySelectorAll('.select-theme'),A=document.querySelectorAll('.select-theme__item'),aj=JSON.parse('"dark"'),at=JSON.parse('"light"'),ar=JSON.parse('"hacker"'),ab=JSON.parse('"solarized"'),aq=JSON.parse('"kimbie"'),E=function(a){var b=document.getElementsByName('msapplication-TileColor')[0],c=document.getElementsByName('theme-color')[0],d=document.getElementsByName('msapplication-navbutton-color')[0],e=document.getElementsByName('apple-mobile-web-app-status-bar-style')[0];a.includes('dark')?(b.setAttribute('content','#fcfcfa'),c.setAttribute('content','#403E41'),d.setAttribute('content','#403E41'),e.setAttribute('content','#403E41')):a.includes('light')?(b.setAttribute('content','#555'),c.setAttribute('content','#eee'),d.setAttribute('content','#eee'),e.setAttribute('content','#eee')):a.includes('hacker')?(b.setAttribute('content','#e3cd26'),c.setAttribute('content','#252526'),d.setAttribute('content','#252526'),e.setAttribute('content','#252526')):a.includes('solarized')?(b.setAttribute('content','#d3af86'),c.setAttribute('content','#51412c'),d.setAttribute('content','#51412c'),e.setAttribute('content','#51412c')):a.includes('kimbie')&&(b.setAttribute('content','#586e75'),c.setAttribute('content','#eee8d5'),d.setAttribute('content','#eee8d5'),e.setAttribute('content','#eee8d5'))},ap=function(a){if(a===aj)return'dark';if(a===at)return'light';if(a===ar)return'hacker';if(a===ab)return'solarized';if(a===aq)return'kimbie'},D?(A?A.forEach(function(a){a.text.trim()===D?a.classList.add('is-active'):a.classList.remove('is-active')}):null,E(D)):E(B.className),A?A.forEach(function(a,b){a.addEventListener('click',function(c){var a=ap(c.target.text.trim()),b,d;localStorage.setItem('theme',a),E(a),B.removeAttribute('class'),B.classList.add('theme__'+a),ai.forEach(function(b){b.querySelectorAll('a').forEach(function(b){b.classList&&(b.text.trim()===a?b.classList.contains('is-active')||b.classList.add('is-active'):b.classList.contains('is-active')&&b.classList.remove('is-active'))})}),window.mermaid&&(a==="dark"||a==="hacker"?(mermaid.initialize({theme:'dark'}),location.reload()):(mermaid.initialize({theme:'default'}),location.reload())),b=document.getElementById('utterances'),b&&b.querySelector('iframe').contentWindow.postMessage({type:'set-theme',theme:a==="dark"||a==="hacker"?'photon-dark':a==='kimbie'?'github-dark-orange':'github-light'},'https://utteranc.es'),d=document.querySelectorAll('.twitter-timeline'),d&&window.postMessage({type:'set-twitter-theme',theme:a==='light'||a==='solarized'?'light':'dark'})})}):null,ao=JSON.parse('"https://dotleo.cn"'),ah=JSON.parse('"https://dotleo.cn/posts/io%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/"'),an=JSON.parse('""'),i=null,j=null,c=null,am=JSON.parse("true"),S=JSON.parse("100"),T=JSON.parse("0.4"),ak=JSON.parse("true"),w=JSON.parse("true"),W=JSON.parse('"main"'),X=JSON.parse('"posts"'),ag=JSON.parse('"page"'),x=null,am&&function(){var a=new XMLHttpRequest;X==="publication"&&ag!=="page"?a.open('GET',ah+"index.json"):a.open('GET',ao+an+"/index.json"),a.setRequestHeader('Content-Type','application/json; charset=utf-8'),a.onload=function(){a.status===200?(x=new Fuse(JSON.parse(a.response.toString('utf-8')),{keys:X.includes('publication')?['title','abstract']:ak?['title','description','content']:['title','description'],includeMatches:w,shouldSort:!0,threshold:T||.4,location:0,distance:S||100,maxPatternLength:32,minMatchCharLength:1,isCaseSensitive:!1,findAllMatches:!1,useExtendedSearch:!1}),window.fuse=x):console.error('['+a.status+']Error:',a.statusText)},a.send()}();function ac(e,a){var b=document.createElement('li'),c,d;b.className='search-result__item',c=document.createElement('a'),c.innerHTML=a.item.title,c.setAttribute('class','search-result__item--title'),c.setAttribute('href',a.item.uri),d=document.createElement('div'),d.setAttribute('class','search-result__item--desc'),a.item.description?d.innerHTML=a.item.description:a.item.content&&(d.innerHTML=a.item.content.substring(0,225)),b.appendChild(c),b.appendChild(d),e.appendChild(b)}function al(f,a){var e=document.createElement('li'),b,d,c;if(e.className='search-result__item',b=null,d=document.createElement('a'),d.innerHTML=a.item.title,d.setAttribute('class','search-result__item--title'),d.setAttribute('href',a.item.uri),a.matches&&a.matches.length){for(c=0;c<a.matches.length;c++)'title'===a.matches[c].key&&(d=document.createElement('a'),d.innerHTML=l(a.matches[c].value,a.matches[c].indices),d.setAttribute('class','search-result__item--title'),d.setAttribute('href',a.item.uri)),'description'===a.matches[c].key?(b=document.createElement('div'),b.setAttribute('class','search-result__item--desc'),b.innerHTML=l(a.item.description,a.matches[c].indices)):'content'===a.matches[c].key?b||(b=document.createElement('div'),b.setAttribute('class','search-result__item--desc'),b.innerHTML=l(a.item.content.substring(0,150),a.matches[c].indices)):a.item.description?(b=document.createElement('div'),b.setAttribute('class','search-result__item--desc'),b.innerHTML=a.item.description):(b=document.createElement('div'),b.setAttribute('class','search-result__item--desc'),b.innerHTML=a.item.content.substring(0,150));e.appendChild(d),b&&e.appendChild(b),e&&f.appendChild(e)}}function H(d,c){var a,b;for(i=document.getElementById('search-results'),j=document.getElementById('search-menu'),i.setAttribute('class','dropdown is-active'),a=document.createElement('ul'),a.setAttribute('class','dropdown-content search-content'),c.length?c.forEach(function(b){var e=document.createElement('li'),c=document.createElement('a'),f,d;c.setAttribute('href',b.uri),c.setAttribute('class','dropdown-item'),c.appendChild(e),f=document.createElement('div'),f.innerHTML=b.title,f.setAttribute('class','menu-item__title'),d=document.createElement('div'),d.setAttribute('class','menu-item__desc'),b.description?d.innerHTML=b.description:b.content&&(d.innerHTML=b.content.substring(0,150)),e.appendChild(f),e.appendChild(d),a.appendChild(c)}):(b=document.createElement('li'),b.setAttribute('class','dropdown-item'),b.innerText='No results found',a.appendChild(b));j.hasChildNodes();)j.removeChild(j.lastChild);j.appendChild(a)}function $(d,c){var a,b;for(i=document.getElementById('search-results'),j=document.getElementById('search-menu'),i.setAttribute('class','dropdown is-active'),a=document.createElement('ul'),a.setAttribute('class','dropdown-content search-content'),c.length?c.forEach(function(b){var g=document.createElement('li'),e=document.createElement('a'),c=null,f,d;if(e.setAttribute('href',b.item.uri),e.setAttribute('class','dropdown-item'),e.appendChild(g),f=document.createElement('div'),f.innerHTML=b.item.title,f.setAttribute('class','menu-item__title'),b.matches&&b.matches.length){for(d=0;d<b.matches.length;d++)'title'===b.matches[d].key&&(f.innerHTML=l(b.matches[d].value,b.matches[d].indices)),'description'===b.matches[d].key?(c=document.createElement('div'),c.setAttribute('class','menu-item__desc'),c.innerHTML=l(b.item.description,b.matches[d].indices)):'content'===b.matches[d].key?c||(c=document.createElement('div'),c.setAttribute('class','menu-item__desc'),c.innerHTML=l(b.item.content.substring(0,150),b.matches[d].indices)):b.item.description?(c=document.createElement('div'),c.setAttribute('class','menu-item__desc'),c.innerHTML=b.item.description):(c=document.createElement('div'),c.setAttribute('class','menu-item__desc'),c.innerHTML=b.item.content.substring(0,150));g.appendChild(f),c&&g.appendChild(c),a.appendChild(e)}}):(b=document.createElement('li'),b.setAttribute('class','dropdown-item'),b.innerText='No results found',a.appendChild(b));j.hasChildNodes();)j.removeChild(j.lastChild);j.appendChild(a)}function _(e,c){var a,d;i=document.getElementById('search-mobile-results'),a=document.createElement('div'),a.setAttribute('class','mobile-search__content'),c.length>0?c.forEach(function(b){var c=document.createElement('a');c.setAttribute('href',b.uri),c.innerHTML='<div class="mobile-search__item"><div class="mobile-search__item--title">📄 '+b.title+'</div><div class="mobile-search__item--desc">'+(b.description?b.description:b.content)+'</div></div>',a.appendChild(c)}):(d=document.createElement('span'),a.appendChild(d));let b=document.getElementById('search-mobile-results');while(b.firstChild)b.removeChild(b.firstChild);i.appendChild(a)}function ad(e,c){var a,d;i=document.getElementById('search-mobile-results'),a=document.createElement('div'),a.setAttribute('class','mobile-search__content'),c.length?c.forEach(function(b){var e=document.createElement('li'),g=document.createElement('a'),c=null,f,d;if(g.setAttribute('href',b.item.uri),g.appendChild(e),e.setAttribute('class','mobile-search__item'),f=document.createElement('div'),f.innerHTML=b.item.title,f.setAttribute('class','mobile-search__item--title'),b.matches&&b.matches.length){for(d=0;d<b.matches.length;d++)'title'===b.matches[d].key&&(f.innerHTML=l(b.matches[d].value,b.matches[d].indices)),'description'===b.matches[d].key?(c=document.createElement('div'),c.setAttribute('class','mobile-search__item--desc'),c.innerHTML=l(b.item.description,b.matches[d].indices)):'content'===b.matches[d].key?c||(c=document.createElement('div'),c.setAttribute('class','mobile-search__item--desc'),c.innerHTML=l(b.item.content.substring(0,150),b.matches[d].indices)):b.item.description?(c=document.createElement('div'),c.setAttribute('class','mobile-search__item--desc'),c.innerHTML=b.item.description):(c=document.createElement('div'),c.setAttribute('class','mobile-search__item--desc'),c.innerHTML=b.item.content.substring(0,150));e.appendChild(f),c&&e.appendChild(c),a.appendChild(g)}}):(d=document.createElement('span'),a.appendChild(d));let b=document.getElementById('search-mobile-results');while(b.firstChild)b.removeChild(b.firstChild);i.appendChild(a)}function l(a,d){if(!d)return a;var b='',c=0;return d.forEach(function(d){if(d[0]===d[1])return null;b+=''+a.substring(c,d[0])+'<span class="search__highlight">'+a.substring(d[0],d[1]+1)+'</span>'+'',c=d[1]+1}),b+=a.substring(c),b}n=document.getElementById('search'),Y=document.getElementById('search-mobile'),q=document.getElementById('search-results'),n?n.addEventListener('input',function(b){var a,e;if(!b.target.value|window.innerWidth<770)return q?q.setAttribute('class','dropdown'):null,d?d.setAttribute('data-display','none'):null,f?f.setAttribute('data-display','block'):null,null;c=b.target.value,a=x.search(b.target.value),W==="main"?w?aa(c,a):M(c,a):(w?$(c,a):H(c,a),e=q.querySelectorAll('.dropdown-item'),e?e.forEach(function(a){a.addEventListener('mousedown',function(a){a.target.click()})}):null)}):null,n?n.addEventListener('blur',function(){if(window.innerWidth<770)return null;q?q.setAttribute('class','dropdown'):null}):null,n?n.addEventListener('click',function(b){var a,d;if(window.innerWidth<770)return null;if(!b.target.value)return q?q.setAttribute('class','dropdown'):null,null;c=b.target.value,a=x.search(b.target.value),W==="main"?w?aa(c,a):M(c,a):(w?$(c,a):H(c,a),d=q.querySelectorAll('.dropdown-item'),d?d.forEach(function(a){a.addEventListener('mousedown',function(a){a.target.click()})}):null)}):null,av=document.getElementById("search-menu"),au=document.querySelector('#search-menu .dropdown-item.is-active'),a=null,aw=null,R=350,n?n.addEventListener('keydown',function(c){var b,e;if(window.innerWidth<770)return null;if(c.key==='Escape'&&(d?d.setAttribute('data-display','none'):null,f?f.setAttribute('data-display','block'):null),b=document.querySelectorAll('#search-menu .dropdown-item'),e=c.which||c.keyCode,!b||!b.length)return null;if(c.key==='ArrowDown'||e===40){a===null?(a=0,b[a].classList.remove('is-active')):(b[a].classList.remove('is-active'),a=a===b.length-1?0:a+1),b[a].classList.add('is-active');let c=b[a].offsetTop+b[a].clientHeight-R;c>0?document.querySelector(".search-content").scrollTop+=b[a].getBoundingClientRect().height:a===0&&(document.querySelector(".search-content").scrollTop=0)}else if(c.key==='ArrowUp'||e===38){a===null?(a=b.length-1,b[a].classList.remove('is-active')):(b[a].classList.remove('is-active'),a=a===0?b.length-1:a-1),b[a].classList.add('is-active');let c=b[a].offsetTop+b[a].clientHeight-R;c<0?document.querySelector(".search-content").scrollTop-=b[a].getBoundingClientRect().height:document.querySelector(".search-content").scrollTop=c+b[a].getBoundingClientRect().height}else c.key==='Enter'||e===13?b[a]&&b[a].getAttribute('href')&&(location.href=b[a].getAttribute('href')):(c.key==='Escape'||e===27)&&(c.target.value=null,i&&i.classList.remove('is-active'))}):null,Y?Y.addEventListener('input',function(a){if(!a.target.value){let a=document.getElementById('search-mobile-results');while(a.firstChild)a.removeChild(a.firstChild);return null}c=a.target.value;var b=x.search(a.target.value);_(c,b),w?ad(c,b):_(c,b)}):null,m=document.querySelector('#search-mobile'),L=document.querySelector('.mobile-search'),K=document.querySelectorAll('.navbar-search'),I=document.querySelector('#search-mobile-close'),v=document.querySelector('#search-mobile-container'),p=document.querySelector('#search-mobile-results'),u=document.querySelector('html'),L&&(L.style.display='none'),K?K.forEach(function(a,b){a.addEventListener('click',function(){v&&(v.style.display='block'),m&&m.focus(),u&&(u.style.overflowY='hidden')})}):null,I?I.addEventListener('click',function(){if(v&&(v.style.display='none'),m&&(m.value=''),p)while(p.firstChild)p.removeChild(p.firstChild);u&&(u.style.overflowY='visible')}):null,m?m.addEventListener('keydown',function(a){var b=a.which||a.keyCode;if(a.key==='Escape'||b===27){if(v&&(v.style.display='none'),m&&(m.value=''),p)while(p.firstChild)p.removeChild(p.firstChild);u&&(u.style.overflowY='visible')}}):null;function M(e,a){var g=document.querySelector('.search-result__body'),b=g.querySelector('ul'),c=document.createElement('ul');e?a&&a&&a.length&&(a.forEach(function(a){ac(c,a)}),d?d.setAttribute('data-display','block'):null,f?f.setAttribute('data-display','none'):null):(d?d.setAttribute('data-display','none'):null,f?f.setAttribute('data-display','block'):null),b.parentNode.replaceChild(c,b)}function aa(e,a){var g=document.querySelector('.search-result__body'),b=g.querySelector('ul'),c=document.createElement('ul');e?a&&a&&a.length&&(a.forEach(function(a){al(c,a)}),d?d.setAttribute('data-display','block'):null,f?f.setAttribute('data-display','none'):null):(d?d.setAttribute('data-display','none'):null,f?f.setAttribute('data-display','block'):null),b.parentNode.replaceChild(c,b)}})</script>
<link rel=stylesheet href=/css/main.min.css>
<meta name=description content="Record life">
<meta name=keywords content="IO,Linux,NIO,Java">
<meta name=created content="2021-10-28T20:07:49+0800">
<meta name=modified content="2021-10-28T20:07:49+0800">
<meta property="article:published_time" content="2021-10-28T20:07:49+0800">
<meta name=author content="dotleo">
<meta property="article:author" content="https://dotleo.cn/posts/io%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/@dotleo">
<meta property="og:site_name" content="dotleo's blog">
<meta property="og:title" content="IO 模型详解">
<meta property="og:url" content="https://dotleo.cn/posts/io%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/">
<meta property="og:type" content="article">
<meta property="og:description" content="Record life">
<meta name=generator content="Hugo 0.88.1">
<meta name=msapplication-TileColor content="#fff">
<meta name=theme-color content="#fff">
<meta name=msapplication-navbutton-color content="#fff">
<meta name=apple-mobile-web-app-status-bar-style content="#fff">
<link rel=canonical href=https://dotleo.cn/posts/io%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/>
<link rel=manifest href=/manifest.json>
<link rel=apple-touch-icon sizes=57x57 href=/favicon/apple-icon-57x57.png>
<link rel=apple-touch-icon sizes=60x60 href=/favicon/apple-icon-60x60.png>
<link rel=apple-touch-icon sizes=72x72 href=/favicon/apple-icon-72x72.png>
<link rel=apple-touch-icon sizes=76x76 href=/favicon/apple-icon-76x76.png>
<link rel=apple-touch-icon sizes=114x114 href=/favicon/apple-icon-114x114.png>
<link rel=apple-touch-icon sizes=120x120 href=/favicon/apple-icon-120x120.png>
<link rel=apple-touch-icon sizes=144x144 href=/favicon/apple-icon-144x144.png>
<link rel=apple-touch-icon sizes=152x152 href=/favicon/apple-icon-152x152.png>
<link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-icon-180x180.png>
<link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-192x192.png>
<link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-512x512.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png>
<link rel=icon type=image/png sizes=96x96 href=/favicon/favicon-96x96.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png>
<meta name=msapplication-TileColor content="#ffffff">
<meta name=msapplication-TileImage content="/ms-icon-144x144.png">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"WebPage","headline":"IO 模型详解","datePublished":"2021-10-28T20:07:49+08:00","dateModified":"2021-10-28T20:07:49+08:00","url":"https://dotleo.cn/posts/io%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/","description":"\u003ch2 id=\"系统调用\"\u003e系统调用\u003c/h2\u003e \u003cp\u003e当系统运行时，第一个启动的程序就是 \u003ccode\u003ekernel\u003c/code\u003e ，它的作用就是各个硬件工作的调度器。为了保证硬件操作规范及 kernel 的稳定性等原因，Linux 将分为了内核空间和用户空间，普通的应用程序是运行在用户空间，无法访问内核空间中的指令等，当然也就无法直接操作硬件。当进程需要访问硬件设备（比如读取磁盘文件、接受网络数据等）时，必 …\u003c/p\u003e","keywords":["IO","Linux","NIO","Java"],"author":{"@type":"Person","name":"dotleo"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dotleo.cn"},"publisher":{"@type":"Organization","name":"dotleo's blog","url":"https://dotleo.cn"}}</script>
<script async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
</head>
<body id=root class=theme__light>
<script>var localTheme=localStorage.getItem('theme');localTheme&&(document.getElementById('root').className='theme__'+localTheme)</script>
<div id=container>
<div class=wrapper data-type=posts data-kind=page>
<nav class="navbar scrolling" role=navigation aria-label="main navigation" data-dir=ltr>
<div class=navbar__brand>
<a href=/ title=Home rel=home class=navbar__logo-link>
<img src=/logo.png alt=Home class=navbar__logo>
</a>
<a href=/ title=Home rel=home class=navbar__title-link>
<h6 class=navbar__title>dotleo's blog</h6>
</a>
</div>
<div class="theme theme-mobile" data-ani=true>
<div class=dropdown>
<button class="dropdown-trigger navbar__slide-down" aria-label="Select Theme Button" data-ani=true><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="none" d="M24 0H0v24h24V0z"/><path fill="currentcolor" d="M6.34 7.93c-3.12 3.12-3.12 8.19.0 11.31C7.9 20.8 9.95 21.58 12 21.58s4.1-.78 5.66-2.34c3.12-3.12 3.12-8.19.0-11.31l-4.95-4.95c-.39-.39-1.02-.39-1.41.0L6.34 7.93zM12 19.59c-1.6.0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59s.62-3.11 1.76-4.24L12 5.1v14.49z"/></svg>
</button>
<div class="dropdown-content select-theme">
<a href=# class="dropdown-item select-theme__item is-active">
light
</a>
<a href=# class="dropdown-item select-theme__item">
dark
</a>
<a href=# class="dropdown-item select-theme__item">
hacker
</a>
<a href=# class="dropdown-item select-theme__item">
solarized
</a>
<a href=# class="dropdown-item select-theme__item">
kimbie
</a>
</div>
</div>
</div>
<div class="mobile-search__btn navbar-search" data-ani=true><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentcolor" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49.0s.41-1.08.0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
</div>
<div id=search-mobile-container class="mobile-search hide" data-dir=ltr>
<div class=mobile-search__top>
<input id=search-mobile type=text aria-label="Mobile Search" placeholder=Search class=mobile-search__top--input>
<div id=search-mobile-close class=mobile-search__top--icon><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path opacity=".87" fill="none" d="M0 0h24v24H0V0z"/><path fill="currentcolor" d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41.0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"/></svg>
</div>
</div>
<div id=search-mobile-results class=mobile-search__body>
</div>
</div>
<a role=button class=navbar__burger aria-label=menu aria-expanded=false data-ani=true>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
</a>
<div class=navbarm__collapse data-open=false>
<ul dir=ltr>
<li class=navbarm__menu--item>
<a href=/>Home</a>
</li>
<li class=navbarm__menu--item>
<a href=/archive>Archive</a>
</li>
<li class=navbarm__menu--item>
<a href=/tags>Tags</a>
</li>
<li class=navbarm__menu--item>
<a href=/categories>Categories</a>
</li>
</ul>
</div>
<div class=navbar__menu>
<div class=theme data-ani=true>
<div class=dropdown>
<button class="dropdown-trigger navbar__slide-down" aria-label="Select Theme Button" data-ani=true><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="none" d="M24 0H0v24h24V0z"/><path fill="currentcolor" d="M6.34 7.93c-3.12 3.12-3.12 8.19.0 11.31C7.9 20.8 9.95 21.58 12 21.58s4.1-.78 5.66-2.34c3.12-3.12 3.12-8.19.0-11.31l-4.95-4.95c-.39-.39-1.02-.39-1.41.0L6.34 7.93zM12 19.59c-1.6.0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59s.62-3.11 1.76-4.24L12 5.1v14.49z"/></svg>
</button>
<div class="dropdown-content select-theme">
<a href=# class="dropdown-item select-theme__item is-active">
light
</a>
<a href=# class="dropdown-item select-theme__item">
dark
</a>
<a href=# class="dropdown-item select-theme__item">
hacker
</a>
<a href=# class="dropdown-item select-theme__item">
solarized
</a>
<a href=# class="dropdown-item select-theme__item">
kimbie
</a>
</div>
</div>
</div>
<a href=/ class="navbar__menu-item navbar__slide-down" dir=ltr data-ani=true>Home</a>
<a href=/archive class="navbar__menu-item navbar__slide-down" dir=ltr data-ani=true>Archive</a>
<a href=/tags class="navbar__menu-item navbar__slide-down" dir=ltr data-ani=true>Tags</a>
<a href=/categories class="navbar__menu-item navbar__slide-down" dir=ltr data-ani=true>Categories</a>
</div>
</nav>
<main class="single__main main-main">
<nav class="breadcrumb hide" aria-label=breadcrumbs>
<script>document.querySelector('.breadcrumb').classList.remove('hide')</script>
<ol>
<li>
<a href=https://dotleo.cn/ class=capitalize>dotleo's blog</a>
</li>
<li>
<a href=https://dotleo.cn/posts/ class=capitalize>Posts</a>
</li>
<li class=is-active>
<span>IO 模型详解</span>
</li>
</ol>
</nav>
<div class=single>
<div class=single__nojs>This page looks best with JavaScript enabled</div>
<script>document.querySelector('.single').classList.remove('hide'),document.querySelector('.single__nojs').classList.add('hide')</script>
<h2 class=single__title data-ani=true>IO 模型详解</h2>
<h3 class=single__subtitle></h3>
<div class=single__meta>
<div class=single__infos>
<time class=single__info title="Written At">📅&nbsp;Oct 28, 2021 </time>
&nbsp;&#183;&nbsp; <span class=single__info title="Reading Time"> ☕&nbsp;14&nbsp;min read </span>
&nbsp;&#183;&nbsp; <span class=single__info title="WRITTEN BY">✍️&nbsp;dotleo</span>
<span class=single__info>
&#183; 👀<span id=busuanzi_value_page_pv>...</span> views
</span>
</div>
<ul class="single__tags caption">
🏷️
<li><a href=https://dotleo.cn/tags/io/ class=single__tag title=IO>#IO</a></li>
<li><a href=https://dotleo.cn/tags/linux/ class=single__tag title=Linux>#Linux</a></li>
<li><a href=https://dotleo.cn/tags/nio/ class=single__tag title=NIO>#NIO</a></li>
<li><a href=https://dotleo.cn/tags/java/ class=single__tag title=Java>#Java</a></li>
</ul>
</div>
<article class=single__contents data-dir=ltr data-ani=true>
<div class=expand>
<button type=button class=expand__button aria-label="Expand Button">
<span class="expand-icon expand-icon__right"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentcolor" d="M9.29 15.88 13.17 12 9.29 8.12c-.39-.39-.39-1.02.0-1.41.39-.39 1.02-.39 1.41.0l4.59 4.59c.39.39.39 1.02.0 1.41L10.7 17.3c-.39.39-1.02.39-1.41.0-.38-.39-.39-1.03.0-1.42z"/></svg>
</span>
What's on this Page
</button>
<div class="expand__content expand__content--toc">
<nav id=TableOfContents>
<ul>
<li><a href=#系统调用>系统调用</a></li>
<li><a href=#学会查看文件描述符>学会查看文件描述符</a></li>
<li><a href=#bio>BIO</a></li>
<li><a href=#nio非阻塞-io>NIO（非阻塞 IO)</a></li>
<li><a href=#多路复用>多路复用</a>
<ul>
<li><a href=#select>select</a></li>
<li><a href=#poll>poll</a></li>
<li><a href=#epoll>epoll</a>
<ul>
<li><a href=#epoll_create>epoll_create</a></li>
<li><a href=#epoll_ctl>epoll_ctl</a></li>
<li><a href=#epoll_wait>epoll_wait</a></li>
<li><a href=#边缘触发和水平触发>边缘触发和水平触发</a></li>
</ul>
</li>
</ul>
</li>
<li><a href=#总结>总结</a>
<ul>
<li><a href=#第一种理解思路>第一种理解思路</a></li>
<li><a href=#第二种理解思路>第二种理解思路</a></li>
</ul>
</li>
<li><a href=#参考内容>参考内容</a></li>
</ul>
</nav>
</div>
</div>
<h2 id=系统调用>系统调用</h2>
<p>当系统运行时，第一个启动的程序就是 <code>kernel</code> ，它的作用就是各个硬件工作的调度器。为了保证硬件操作规范及 kernel 的稳定性等原因，Linux 将分为了内核空间和用户空间，普通的应用程序是运行在用户空间，无法访问内核空间中的指令等，当然也就无法直接操作硬件。当进程需要访问硬件设备（比如读取磁盘文件、接受网络数据等）时，必须由用户空间（或者叫用户态、用户模式）切换到内核空间，这是通过 <strong>系统调用</strong> 实现。strace 可以跟踪到一个进程产生的系统调用，包括参数、返回值及执行消耗时间等。</p>
<p>关于 strace 的使用及参数，可参考 <a href=https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/strace.html>6. strace 跟踪进程中的系统调用 — Linux Tools Quick Tutorial</a>，这里就不过多介绍了，我们主要了解一个可以详细打印系统调用的运行参数。</p>
<p><code>strace -ff -o &lt;filename> command</code>: 该命令及参数可以将该 <code>command</code>运行后的 fork 出的所有线程的跟踪结果输出到相应的 <code>filename.pid</code> 中，<code>pid</code> 是进程号及 fork 出的线程编号。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Demo</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;hello, world&#34;</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>先跑起来再说，先新建一个 <code>Demo.java</code> 源文件。</li>
<li>然后运行<code>mkdir javatest</code>创建一个文件夹，方便我们将所有线程的跟踪结果输出到一起方便查看。</li>
<li>执行<code>strace -ff -o javatest/demo java Demo</code></li>
<li>此时 <code>javatest</code> 件夹中就出现了以 <code>demo.pid</code> 命名的若干文件。</li>
<li>我们找到最大的一个，打开后搜索 <code>hello, world</code> ，就能看到它有一个系统调用 <code>write(1, "hello, world", 12) = 12</code>，即系统调用了 <code>write()</code> ，其中第一个参数 1 表示标准输出流，即通过系统调用将 &ldquo;hello,world&rdquo; 输出到标准输出流中。</li>
</ol>
<p>到这里，我们就可以使用 strace 分析一个程序的系统调用了。</p>
<h2 id=学会查看文件描述符>学会查看文件描述符</h2>
<blockquote>
<p><a href=https://baike.baidu.com/item/%E5%86%85%E6%A0%B8/108410>内核</a>（kernel）利用文件描述符（file descriptor）来访问文件。文件描述符是 <a href=https://baike.baidu.com/item/%E9%9D%9E%E8%B4%9F%E6%95%B4%E6%95%B0/2951833>非负整数</a>。打开现存文件或新建文件时，内核会返回一个文件描述符。读写文件也需要使用文件描述符来指定待读写的文件。</p>
</blockquote>
<p>Linux 的 <code>/proc/$pid/fd</code> 目录下存放了此进程所有打开的 fd。当然，有些可能不是本进程自己打开的，如通过 fork() 从父进程继承而来的。如果我们想查看文件描述符，需要先获取到进程 id(pid)，然后执行<code>ls /proc/$pid/fd</code>即可查看到该进程打开的文件描述符。</p>
<p>为了方便观察，我们稍修改一下上面的程序：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Demo</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;hello, world&#34;</span><span class=o>);</span>
        <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>60000L</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>java Demo</code>运行程序后，使用<code>jps -l | grep Demo</code>找到 <code>pid</code>，然后运行<code>ls -l /proc/$pid/fd</code> 。</p>
<pre tabindex=0><code>lrwx------ 1 root root 64 7 月   4 23:56 0 -&gt; /dev/pts/9
lrwx------ 1 root root 64 7 月   4 23:56 1 -&gt; /dev/pts/9
lrwx------ 1 root root 64 7 月   4 23:56 2 -&gt; /dev/pts/9
lr-x------ 1 root root 64 7 月   4 23:56 3 -&gt; /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.252.b09-2.el7_8.x86_64/jre/lib/rt.jar
</code></pre><p>在我的电脑上，结果如上所示。其中<em>文件描述符 3</em> 是一个 Java 运行时必须的 jar 包，其他 0~2 分别代表标准输入、标准输出及标准错误，每个进程都会有这 3 个描述符。我们可以使用<code>strace</code>看到<code>System.out.println("hello, world");</code> 底层系统调用了<code>write(1, "hello, world", 12) = 12</code>，即向标准输出中输出"hello, world"。</p>
<h2 id=bio>BIO</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>import</span> <span class=nn>java.io.BufferedReader</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.InputStream</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.InputStreamReader</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.net.InetSocketAddress</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.net.ServerSocket</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.net.Socket</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Main</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=c1>// socket(AF_INET, SOCK_STREAM, IPPROTO_IP) = 5
</span><span class=c1></span>        <span class=n>ServerSocket</span> <span class=n>socket</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ServerSocket</span><span class=o>();</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;serversocket is created&#34;</span><span class=o>);</span>
        <span class=c1>// bind(5, {sa_family=AF_INET, sin_port=htons(6666), sin_addr=inet_addr(&#34;0.0.0.0&#34;)}, 16) = 0
</span><span class=c1></span>        <span class=c1>// listen(5, 50)                           = 0
</span><span class=c1></span>        <span class=n>socket</span><span class=o>.</span><span class=na>bind</span><span class=o>(</span><span class=k>new</span> <span class=n>InetSocketAddress</span><span class=o>(</span><span class=n>6666</span><span class=o>));</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;serversocket is binded with 6666&#34;</span><span class=o>);</span>
        <span class=c1>// 阻塞：
</span><span class=c1></span>        <span class=c1>// poll([{fd=5, events=POLLIN|POLLERR}], 1, -1
</span><span class=c1></span>        <span class=c1>// 当有客户端连接时：
</span><span class=c1></span>        <span class=c1>// poll([{fd=5, events=POLLIN|POLLERR}], 1, -1) = 1 ([{fd=5, revents=POLLIN}])
</span><span class=c1></span>        <span class=c1>// accept(5, {sa_family=AF_INET, sin_port=htons(42594), sin_addr=inet_addr(&#34;127.0.0.1&#34;)}, [16]) = 6
</span><span class=c1></span>        <span class=n>Socket</span> <span class=n>client</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=na>accept</span><span class=o>();</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;serversocket is polling&#34;</span><span class=o>);</span>
        <span class=n>InputStream</span> <span class=n>in</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=na>getInputStream</span><span class=o>();</span>
        <span class=n>BufferedReader</span> <span class=n>reader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedReader</span><span class=o>(</span><span class=k>new</span> <span class=n>InputStreamReader</span><span class=o>(</span><span class=n>in</span><span class=o>));</span>
        <span class=k>while</span> <span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>{</span>
            <span class=c1>// 阻塞：
</span><span class=c1></span>            <span class=c1>// recvfrom(6,
</span><span class=c1></span>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>reader</span><span class=o>.</span><span class=na>readLine</span><span class=o>());</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>如上代码，是一个简单的 socket 通信服务端的代码，可以使用<code>strace</code>命令自己查看系统调用情况，其中关键几步的系统调用在注释中已经给出。可以看到，一个服务端的 socket 经历<code>socket</code>- <code>bind</code> - <code>listen</code>，然后调用<code>poll</code>等待客户端连接。当有客户端连接时，<code>poll</code>结束阻塞返回结果，然后系统调用<code>accept</code>会创建新的文件描述符（上面注释中的 <em>6</em> ）用来和客户端通信。</p>
<p>因为我们代码中需要读取一行数据，<code>reader.readLine()</code>底层的系统调用<code>recvfrom</code>是<strong>阻塞</strong>的，当没有内容时会一直阻塞该线程。</p>
<p><img src=http://img.dotleo.cn/blog/2020070515Fu0eKWSASZSe.png alt=2020070515Fu0eKWSASZSe></p>
<p>此时，如果我们想要再用一个客户端连接服务端，是不能得到及时响应的，因为线程被阻塞住了，大家可以动手尝试（如果代码和上面相同，则可以使用<code>nc localhost 6666</code>在本机模拟连接）。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>import</span> <span class=nn>java.io.BufferedReader</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.InputStream</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.InputStreamReader</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.net.InetSocketAddress</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.net.ServerSocket</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.net.Socket</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Main2</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=n>ServerSocket</span> <span class=n>socket</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ServerSocket</span><span class=o>();</span>
        <span class=n>socket</span><span class=o>.</span><span class=na>bind</span><span class=o>(</span><span class=k>new</span> <span class=n>InetSocketAddress</span><span class=o>(</span><span class=n>6666</span><span class=o>));</span>
        <span class=k>while</span> <span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>Socket</span> <span class=n>client</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=na>accept</span><span class=o>();</span>
            <span class=k>new</span> <span class=n>Thread</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=o>{</span>
                <span class=k>try</span> <span class=o>{</span>
                    <span class=n>InputStream</span> <span class=n>in</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=na>getInputStream</span><span class=o>();</span>
                    <span class=n>BufferedReader</span> <span class=n>reader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedReader</span><span class=o>(</span><span class=k>new</span> <span class=n>InputStreamReader</span><span class=o>(</span><span class=n>in</span><span class=o>));</span>
                    <span class=k>while</span> <span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>{</span>
                        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>reader</span><span class=o>.</span><span class=na>readLine</span><span class=o>());</span>
                    <span class=o>}</span>
                <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
                <span class=o>}</span>
            <span class=o>}).</span><span class=na>start</span><span class=o>();</span>
        <span class=o>}</span>

    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>为了能响应多个客户端的连接，我们通过每个客户端连接创建一个线程的方式改造了代码。这样，即使客户端没有发送内容导致服务端对应线程<strong>读取阻塞</strong>，也不会影响其他线程及客户端的接入。上述代码是一种比较常见的 Java Socket 编程方式，当然如果使用线程池创建线程可以减少因为不断创建线程带来的性能损耗。</p>
<p>上面这种方式是一种很常见的使用 BIO 与客户端通信，它有非常明显的<strong>缺点</strong> ：</p>
<ol>
<li>多线程时，CPU 的线程切换会导致上下文切换，带来不小的性能开销。</li>
<li>每个线程本身需要占用资源。每个客户端接入需要新建线程，每个线程本身就需要占用不小内存资源。</li>
</ol>
<h2 id=nio非阻塞-io>NIO（非阻塞 IO)</h2>
<p>BIO 存在上面所说缺点，它的本质是因为读取时会阻塞。因此如果我们读取时，如果客户端有数据（已发送数据或正在发送），则读取数据。没有数据时，立即返回。如此，我们就可以使用一个线程，轮询所有的客户端 socket 连接。有数据则读取，没有数据则立即返回，继续下一次的读取尝试。这便是 <strong>NIO</strong> 。</p>
<p>注：这里的 NIO 并非 Java 中的 NIO，Java 中的 NIO 为 New IO，它实际上是结合了多路复用技术。</p>
<p>伪代码如下：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=k>while</span> <span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>{</span>
    <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>fds</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>fds</span><span class=o>[</span><span class=n>i</span><span class=o>].</span><span class=na>recviced</span><span class=o>())</span> <span class=o>{</span>
            <span class=n>fds</span><span class=o>[</span><span class=n>i</span><span class=o>].</span><span class=na>read</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=http://img.dotleo.cn/blog/2020070516G348FLDLtlAm.png alt=2020070516G348FLDLtlAm></p>
<p>如果我们把整个 IO 过程分为等待数据阶段和内核数据到用户空间的复制两部分，和 BIO 比第二部分是没有变化的。区别在于第一部分，在等待数据时不阻塞，没有数据立即返回，有数据时才阻塞读取，因此我们只需要一个线程轮询读取数据即可。</p>
<p>NIO 解决了 BIO 的两个缺点：它只用一个线程轮询即可，不需要创建过多线程导致 CPU 频繁的上下文切换；也没有线程过多带来的内存占用不可忽视的情况。那么它就完美了吗？</p>
<p>不，从上图可以看出，NIO 的<code>recvfrom</code>虽然能立即返回，但这一次的请求仍然是通过 <strong>系统调用</strong> 的方式，假设我们有 1 万个客户端同时连接服务端，那么一次轮询就需要 1 万次系统调用，大家都知道系统调用会进行用户态和内核态的切换，也是不小的消耗。</p>
<p>总结一下，NIO 解决了 BIO 的 2 个明显的缺点，但它自身依然存在不足：</p>
<ol>
<li>当客户端连接多时，每次轮询需要多次系统调用，会在用户态和内核态之间切换，带来不小的消耗。</li>
<li>每 2 次轮询的时间间隔不好掌握，时间短容易白忙活；时间长会造成高延迟。</li>
</ol>
<h2 id=多路复用>多路复用</h2>
<p>NIO 解决了 BIO 的问题，但是当客户端连接多时，每次轮询需要很多次系统调用。如果想避免它，我们可以想想有什么办法让这么多次的系统调用<strong>变成 1 次系统调用</strong> ，这样的话问题不就解决了吗？</p>
<p><strong>多路复用</strong>其实就是由内核提供给几个命令，通过调用它们，我们可以一次性将所有需要监听的客户端文件描述符传递给内核后阻塞，由内核通过自己的方式去监控这些文件描述符，当它们有变化时及时通知我们就可以。这样，我们就解决了 NIO 多次系统调用的不足。</p>
<p><img src=http://img.dotleo.cn/blog/2020070720pLXOj0Wxds2r.png alt=2020070720pLXOj0Wxds2r></p>
<p>以 select 为例，等待数据阶段，程序将所有需要监听的 socket 组装，调用系统调用函数 select 后阻塞。当有任一可读时，函数便返回。然后再发起 recvfrom 读取数据。因此很好解决了 NIO 多次系统调用的缺点。</p>
<h3 id=select>select</h3>
<p>select 函数声明如下：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=cp>#INCLUDE &lt;SYS/TIME.H&gt;
</span><span class=cp>#INCLUDE &lt;SYS/TYPES.H&gt;
</span><span class=cp>#INCLUDE &lt;UNISTD.H&gt;
</span><span class=cp></span>
<span class=kt>int</span> <span class=nf>select</span><span class=p>(</span><span class=kt>int</span> <span class=n>maxfd</span><span class=p>,</span> <span class=n>fd_set</span> <span class=o>*</span><span class=n>readfds</span><span class=p>,</span> <span class=n>fd_set</span> <span class=o>*</span><span class=n>writefds</span><span class=p>,</span>
                  <span class=n>fd_set</span> <span class=o>*</span><span class=n>exceptfds</span><span class=p>,</span> <span class=k>struct</span> <span class=nc>timeval</span> <span class=o>*</span><span class=n>timeout</span><span class=p>);</span>
</code></pre></td></tr></table>
</div>
</div><p>参数说明：</p>
<ul>
<li>readfds、writefds、exceptfds：fd_set 我们可以理解为类似位图。 fd_set 声明的是一个集合，也就是说，readfs、writefds、exceptfds 都是容器，分别为需要监听读、监听写、监听异常的文件描述符，该“位图”在定义时设置最大有 1024 位，因此对文件描述符多少有限制。</li>
<li>maxfd：是一个整数值，为所有描述符中最大值 +1，它的作用就是遍历文件描述符时减少遍历次数，只遍历 0 到 maxfd 即可。linux 默认文件描述符最大 1024，如果我们的三个 fds 只传入了少数几个文件描述符，指定 maxfd 可以就能大大减少循环次数。</li>
<li>timeout：可以选择阻塞，可以选择非阻塞，还可以选择定时返回。如果为 NULL，则为阻塞。如果将该结构体里的值设置为 0 则为非阻塞。设置大于 0 时会在超时后返回。</li>
</ul>
<p>使用 select 的一般步骤：</p>
<ol>
<li>将 fds 各位全部清空</li>
<li>将 fds 需要监听的文件描述符对应位置为 1</li>
<li>调用 select 函数监听置为 1 的文件描述符是否有数据到来</li>
<li>当状态为 1 的文件描述符有数据到来时，此时你的状态仍然为 1，但是其他状态为 1 的文件描述如果没有数据到来，那么此时会将这些文件描述符置为 0</li>
<li>当 select 函数返回后，只能通过遍历的方式获取准备就绪的文件描述符，然后对该文件描述符做后续操作。</li>
</ol>
<p><strong>注意</strong> ：我们只可以通过返回结果获取到有数据到来的文件描述符，但不可以获取到数据，如果需要获取数据，还需要通过该文件描述符去读取。</p>
<p>select 底层一般的执行步骤：</p>
<ol>
<li>从用户空间拷贝 fd_set 到内核空间</li>
<li>先把所有 fd_set 扫一遍</li>
<li>如果发现有可用的 fd，则调到 5</li>
<li>如果没有，当前线程去 Sleep xx 秒 (schedle timeout 机制）</li>
<li>xx 秒后自己醒来，或者状态变化的 fd 唤醒自己，调到 2 重新执行</li>
<li>结束循环，返回（可能因为 timeout 超时返回）</li>
</ol>
<p>可以看到，虽然 select 也会在内核态和用户态做遍历操作，但遍历时没有进行系统调用了，这会大大提高它的性能。</p>
<p>select 的缺点：</p>
<ol>
<li>fds 默认大小 1024 限制，虽然可以通过修改宏定义甚至重新编译内核的方式提升这一限制，但是这样也会造成效率的降低</li>
<li>select 返回时，会修改 fds，因此每次重新调用时需要初始化</li>
<li>得到返回结果后，需要遍历 fds 才能找到有变化的文件描述符，在文件描述符较多时效率不高</li>
<li>每次调用 select，所有的 fds 都需要在内核态和用户态进行拷贝</li>
</ol>
<p>这部分内容的实践需要用到 C 代码，感兴趣的可以查看这篇文章 <a href=https://zhuanlan.zhihu.com/p/57518857>linux select 函数解析以及事例 - 知乎</a>，这里只简单理解其原理即可。</p>
<h3 id=poll>poll</h3>
<p>poll 函数声明如下：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=cp>#INCLUDE &lt;POLL.H&gt;
</span><span class=cp></span>
<span class=kt>int</span> <span class=nf>poll</span><span class=p>(</span><span class=k>struct</span> <span class=nc>pollfd</span> <span class=o>*</span><span class=n>fds</span><span class=p>,</span> <span class=n>nfds_t</span> <span class=n>nfds</span><span class=p>,</span> <span class=kt>int</span> <span class=n>timeout</span><span class=p>);</span>

 <span class=k>struct</span> <span class=nc>pollfd</span> <span class=p>{</span>

       <span class=kt>int</span>   <span class=n>fd</span><span class=p>;</span>  <span class=cm>/* file descriptor */</span>

       <span class=kt>short</span> <span class=n>events</span><span class=p>;</span>  <span class=cm>/* requested events */</span>

       <span class=kt>short</span> <span class=n>revents</span><span class=p>;</span>  <span class=cm>/* returned events */</span>

   <span class=p>};</span>
</code></pre></td></tr></table>
</div>
</div><p>pull 的所有改变都是围绕结构体 pollfd 进行的。</p>
<p>参数说明：</p>
<ul>
<li>fds：和 select 的 readfds 等不同的是结构体内部的区别，之前我们说过 select 的 readfds 等类似于位图，poll 中的结构体有三个字段：1) fd，表示文件描述符 2) events，表示关注的事件 3) revents，表示实际发生的事件。</li>
<li>nfds：用来指定第一个参数数组元素个数。</li>
<li>timeout：指定等待的毫秒数，无论 I/O 是否准备好，poll() 都会返回。</li>
</ul>
<p>和 select 的区别：</p>
<p>poll 和 select 的区别并不大，不过是通过这种链表的形式，可以传递近乎无限的文件描述符。并且调用后返回的结果，会写入到 revents 字段，不会影响请求时传入的 events 字段，将 revents 字段抹除后就可以就可以再次调用。</p>
<ul>
<li>解决了 select 文件描述符多少的限制。</li>
<li>通过特定字段返回数据，不会影响请求数据，数据可复用。</li>
</ul>
<p>但它依然存在问题：</p>
<ul>
<li>需要在内核态和用户态之间进行拷贝。</li>
<li>需要在内核态和用户态中遍历。</li>
</ul>
<h3 id=epoll>epoll</h3>
<p>epoll 共有 3 个函数，分别为 <code>epoll_create</code> , <code>epoll_ctl</code> 和 <code>epoll_wait</code>, 下面我们分别聊一下这三个函数。</p>
<h4 id=epoll_create>epoll_create</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>int</span> <span class=nf>epoll_create</span><span class=p>(</span><span class=kt>int</span> <span class=n>size</span><span class=p>);</span>
</code></pre></td></tr></table>
</div>
</div><p>创建一个 epoll 的句柄。在 <code>epoll_create</code> 的最初实现版本时， size 参数的作用是创建 epoll 实例时候告诉内核需要使用多少个文件描述符。内核会使用 size 的大小去申请对应的内存（如果在使用的时候超过了给定的 size， 内核会申请更多的空间）。现在，这个 size 参数不再使用了（内核会动态的申请需要的内存）。但要注意的是，这个 size 必须要大于 0，为了兼容旧版的 linux 内核的代码。</p>
<h4 id=epoll_ctl>epoll_ctl</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>int</span> <span class=n>epoll_ctl</span><span class=p>(</span><span class=kt>int</span> <span class=n>epfd</span><span class=p>,</span> <span class=kt>int</span> <span class=n>op</span><span class=p>,</span> <span class=kt>int</span> <span class=n>fd</span><span class=p>,</span> <span class=k>struct</span> <span class=n>epoll_event</span> <span class=o>*</span><span class=n>event</span><span class=p>)</span><span class=err>；</span>
</code></pre></td></tr></table>
</div>
</div><p>函数是对指定描述符 fd 执行 op 操作。其中参数分别代表：</p>
<ul>
<li>epfd: 是 <code>epoll_create</code> 的返回值。</li>
<li>op: 表示 op 操作，用三个宏来表示：添加 EPOLL_CTL_ADD，删除 EPOLL_CTL_DEL，修改 EPOLL_CTL_MOD。分别添加、删除和修改对 fd 的监听事件。</li>
<li>fd：是需要监听的 fd（文件描述符）。</li>
<li>epoll_event：是告诉内核需要监听什么事件，struct epoll_event 结构如下：</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=k>struct</span> <span class=n>epoll_event</span> <span class=p>{</span>
  <span class=n>__uint32_t</span> <span class=n>events</span><span class=p>;</span>  <span class=cm>/* Epoll events */</span>
  <span class=n>epoll_data_t</span> <span class=n>data</span><span class=p>;</span>  <span class=cm>/* User data variable */</span>
<span class=p>};</span>

<span class=c1>//events 可以是以下几个宏的集合：
</span><span class=c1></span><span class=n>EPOLLIN</span> <span class=err>：表示对应的文件描述符可以读（包括对端</span> <span class=n>SOCKET</span> <span class=err>正常关闭）；</span>
<span class=n>EPOLLOUT</span><span class=err>：表示对应的文件描述符可以写；</span>
<span class=n>EPOLLPRI</span><span class=err>：表示对应的文件描述符有紧急的数据可读（这里应该表示有带外数据到来）；</span>
<span class=n>EPOLLERR</span><span class=err>：表示对应的文件描述符发生错误；</span>
<span class=n>EPOLLHUP</span><span class=err>：表示对应的文件描述符被挂断；</span>
<span class=n>EPOLLET</span><span class=err>：</span> <span class=err>将</span> <span class=n>EPOLL</span> <span class=err>设为边缘触发</span> <span class=p>(</span><span class=n>Edge</span> <span class=n>Triggered</span><span class=p>)</span> <span class=err>模式，这是相对于水平触发</span> <span class=p>(</span><span class=n>Level</span> <span class=n>Triggered</span><span class=p>)</span> <span class=err>来说的。</span>
<span class=n>EPOLLONESHOT</span><span class=err>：只监听一次事件，当监听完这次事件之后，如果还需要继续监听这个</span> <span class=n>socket</span> <span class=err>的话，需要再次把这个</span> <span class=n>socket</span> <span class=err>加入到</span> <span class=n>EPOLL</span> <span class=err>队列里</span>
</code></pre></td></tr></table>
</div>
</div><h4 id=epoll_wait>epoll_wait</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>int</span> <span class=nf>epoll_wait</span><span class=p>(</span><span class=kt>int</span> <span class=n>epfd</span><span class=p>,</span> <span class=k>struct</span> <span class=n>epoll_event</span> <span class=o>*</span> <span class=n>events</span><span class=p>,</span> <span class=kt>int</span> <span class=n>maxevents</span><span class=p>,</span> <span class=kt>int</span> <span class=n>timeout</span><span class=p>);</span>
</code></pre></td></tr></table>
</div>
</div><p>等待 epfd 上的 io 事件，最多返回 maxevents 个事件。</p>
<ul>
<li>epfd: <code>epoll_create</code> 的返回值，在 <code>epoll_ctl</code> 中也有用到。</li>
<li>events: 用来从内核得到事件的集合。</li>
<li>maxevents: 告诉内核返回事件集合的最大条数。</li>
<li>timeout: 在该时间内没有事件发生，则超时返回。</li>
</ul>
<h4 id=边缘触发和水平触发>边缘触发和水平触发</h4>
<p>在介绍 <code>epoll_ctl</code> 时，结构体 <code>epoll_event</code> 的 <code>events</code> 宏定义中，EPOLLET 代表边缘触发 (Edge Triggered) 模式。与之相对的是水平触发 (Level Triggered)，它们之间的区别在于：</p>
<ul>
<li><strong>LT 模式</strong> ：当 <code>epoll_wait</code> 检测到描述符事件发生并将此事件通知应用程序，<strong>应用程序可以不立即处理该事件</strong> 。下次调用 <code>epoll_wait</code> 时，会再次响应应用程序并通知此事件。</li>
<li><strong>ET 模式</strong> ：当 <code>epoll_wait</code> 检测到描述符事件发生并将此事件通知应用程序，<strong>应用程序必须立即处理该事件</strong> 。如果不处理，下次调用 <code>epoll_wait</code> 时，不会再次响应应用程序并通知此事件。</li>
</ul>
<p>水平触发是只要读缓冲区有数据，就会一直触发可读信号，而边缘触发仅仅在空变为非空的时候通知一次。举个例子：</p>
<ol>
<li>读缓冲区刚开始是空的</li>
<li>读缓冲区写入 2KB 数据</li>
<li>水平触发和边缘触发模式此时都会发出可读信号</li>
<li>收到信号通知后，读取了 1kb 的数据，读缓冲区还剩余 1KB 数据</li>
<li>水平触发会再次进行通知，而边缘触发不会再进行通知</li>
</ol>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=c1>//水平触发
</span><span class=c1></span><span class=n>ret</span> <span class=o>=</span> <span class=n>read</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>));</span>

<span class=c1>//边缘触发（代码不完整，仅为简单区别与水平触发方式的代码）
</span><span class=c1></span><span class=k>while</span><span class=p>(</span><span class=nb>true</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>ret</span> <span class=o>=</span> <span class=n>read</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>ret</span> <span class=o>==</span> <span class=n>EAGAIN</span><span class=p>)</span> <span class=k>break</span><span class=p>;</span>
<span class=p>}</span>

</code></pre></td></tr></table>
</div>
</div><h2 id=总结>总结</h2>
<p>该部分总结主要源于阅读了 UNIX 网络编程卷 1：套接字联网 API（第三版）（大约 122 页之后的一部分内容）觉得有了更深层次的理解，所以根据该书的观点和上述内容做一个总结，让大家进一步理解它们之间的区别。</p>
<h3 id=第一种理解思路>第一种理解思路</h3>
<p>不论 BIO、NIO、多路复用，都围绕着两个问题进行设计：</p>
<ol>
<li>创建太多线程带来的性能消耗</li>
<li>多次系统调用带来的性能消耗</li>
</ol>
<p>下面来看看这些 IO 模型如何解决这两个问题：</p>
<ul>
<li>BIO，因为每次的读取都会阻塞，我们不得不创建多个线程来请求，创建多线程会导致：1）线程本身占用较多资源 2）线程切换导致上下文切换带来性能消耗 3）线程是有限的，因此对请求数有限制</li>
<li>NIO，因为 NIO 在没有可读内容时立即返回，所以我们可以通过一个线程遍历需要读取的请求而不创建多线程，但这也会带来：1）多次系统调用带来性能消耗 2）当没有读取到内容时，不能精确控制下次调用时机导致大量不必要调用 3）可能某个读取耗时较多时，会导致延时</li>
<li>多路复用，多路复用解决了这两个问题。通过一个线程注册多个读取请求，该线程阻塞等待（只有一个线程），如果有内容可读取则返回。此时再去读取，肯定可以获取到内容。
<ul>
<li>select, 通过 readfds、writefds 和 exceptfds 每次传递所有需要监听的各种类型的 fds。存在以下问题：1）每次需要在用户态和内核态拷贝所有的 fds 2）在用户态和内核态如果要获得有事件的 fds，需要遍历集合 3）fds 类似于位图，有长度限制，相应的 fd 有个数限制（默认 1024) 4）内核态会置零 fds，每次都需要重新设置</li>
<li>poll, 通过 pollfd 的定义，解决了 select 因为类似于位图的结构导致的个数限制，且 pollfd 中有 reevents 来供内核态设置事件，每次只需要清理这个字段就可以，不需要重新设置 pollfd。但仍然存在两个问题：1）每次需要在用户态和内核态拷贝所有的 fds 2）在用户态和内核态如果要获得有事件的 fds，需要遍历集合</li>
<li>epoll, 通过 3 个方法，将事件监听交给内核记录，有事件发生时，也仅返回发生的事件集合。因此解决了用户态和内核态拷贝所有 fds ，用户态和内核态需要遍历 fds 这两个问题。</li>
</ul>
</li>
</ul>
<h3 id=第二种理解思路>第二种理解思路</h3>
<p><img src=http://img.dotleo.cn/blog/2020081321uLC0HA10d67861.png alt=2020081321uLC0HA10d67861.png></p>
<p>我们可以认为所有的系统 I/O 都分为两个阶段：等待就绪和操作。</p>
<ul>
<li>BIO: 等待就绪和操作整个过程都是阻塞状态。</li>
<li>NIO: 在等待数据阶段非阻塞进行多次检查，数据就绪后阻塞读取。</li>
<li>多路复用：通过一个线程阻塞等待所有需要监听的文件描述符数据就绪，如果有任一数据就绪，则再阻塞读取。</li>
<li>信号驱动：可以认为是向系统注册了关注的事件，当事件发生时，系统通过发送信号的方式通知启动 I/O 操作。这个看了很多知乎的比较，比较靠谱的一种认为，多路复用基于事件驱动来实现，事件驱动是多路复用的核心机制。</li>
<li>异步 IO: 也是信号驱动的一种实现，事件发生时，内核将数据拷贝到调用时指定的内存空间中，然后发送信号。</li>
</ul>
<h2 id=参考内容>参考内容</h2>
<ol>
<li><a href="https://www.bilibili.com/video/BV1qJ411w7du?t=11">【并发】IO 多路复用 select/poll/epoll 介绍_哔哩哔哩 （゜ - ゜） つロ 干杯~-bilibili</a></li>
<li>UNIX 网络编程卷 1：套接字联网 API（第三版）- 122 页</li>
<li><a href=https://zhuanlan.zhihu.com/p/57518857>linux select 函数解析以及事例 - 知乎</a></li>
<li><a href=https://tech.meituan.com/2016/11/04/nio.html>Java NIO 浅析 - 美团技术团队</a></li>
<li><a href=https://www.zhihu.com/question/26943938/answer/68773398>如何深刻理解 Reactor 和 Proactor？ - 知乎</a></li>
<li><a href="https://segmentfault.com/a/1190000003063859?utm_source=Weibo&utm_medium=shareLink&utm_campaign=socialShare&from=timeline&isappinstalled=0">Linux IO 模式及 select、poll、epoll 详解 - 人云思云 - SegmentFault 思否</a></li>
<li><a href=https://juejin.im/post/6844903878685622285#heading-5>epoll 边缘触发与水平触发 - 掘金</a></li>
<li><a href=https://blog.csdn.net/lyztyycode/article/details/78648798>Linux 惊群效应详解（最详细的了吧）_lyztyycode 的博客 - CSDN 博客_惊群效应</a></li>
</ol>
</article>
<script defer src=/js/clipboard.min.1626706afc88d95ebe1173b553ec732c6dc82a576989315fdf5e7779af738a44.js></script>
<script defer src=/js/helper/prev.min.js></script>
<script defer src=/js/helper/prop.min.js></script>
<script>'use strict';document.addEventListener('DOMContentLoaded',function(){var a=!1,b=document.querySelectorAll('pre.chroma'),c=document.querySelectorAll('.language-code'),d=document.querySelectorAll('div.language-\\$'),e=document.querySelectorAll('div.language-\\>'),f=function(c){var k=c,b=c.textContent,j,g,h,i,d,f,e;if(b.length>15){a||(j=new ClipboardJS('.copy-to-clipboard',{text:function(a){var c=prev(a).querySelectorAll('code');return c.length>1?b=prev(a).querySelector('code[class^="language-"]').textContent:b=prev(a).querySelector('code').textContent,b.replace(/^\$\s/gm,'')}}),j.on('success',function(a){a.clearSelection(),g=prop(a.trigger.parentNode,'tagName')=='PRE',a.trigger.setAttribute('aria-label','Copied to clipboard!'),a.trigger.classList.add('tooltipped'),a.trigger.classList.add('tooltipped-w')}),j.on('error',function(a){g=prop(a.trigger.parentNode,'tagName')=='PRE',a.trigger.setAttribute('aria-label',a.action.toString()),a.trigger.classList.add('tooltipped'),a.trigger.classList.add('tooltipped-w')}),a=!0),h=['language-mermaid','language-viz','language-wave','language-chart','language-msc','language-flowchart'],i=!1,d=k.getAttribute('class');for(f=0;f<h.length;f++)if(d&&d.startsWith(h[f])){i=!0;break}i||d&&(e=document.createElement('span'),e.setAttribute('class','copy-to-clipboard'),e.setAttribute('title','Copy to clipboard'),c.parentNode.parentNode.insertBefore(e,c.parentNode.nextElementSibling))}},g=function(b){var a=document.createElement('span');a.setAttribute('class','copy-to-clipboard'),a.setAttribute('title','Copy to clipboard'),b.parentNode.parentNode.insertBefore(a,b.parentNode.nextElementSibling)};b?b.forEach(function(a){a.querySelectorAll('code').forEach(function(a){f(a)})}):null,c?c.forEach(function(a){a.querySelectorAll('code').forEach(function(a){f(a)})}):null,d?d.forEach(function(a){a.querySelectorAll('code').forEach(function(a){g(a)})}):null,e?e.forEach(function(a){a.querySelectorAll('code').forEach(function(a){g(a)})}):null})</script>
<script>'use strict';var langCodeElem,dollarCodeElem,gtCodeElem;function wrap(a,b){a.parentNode.insertBefore(b,a),b.appendChild(a)}(function(){var a=document.querySelector('.single__contents');a?a.querySelectorAll('pre > code').forEach(function(b){var a=b.getAttribute('data-lang'),c=document.createElement('div'),e=null,d=null;a&&a.includes(':')?(e=a.split(':')[0],d=a.split(':')[1],c.className='language-'+e,c.setAttribute('data-lang',d),b.className='language-'+e,b.setAttribute('data-lang',d),b.setAttribute('id',d)):a||(c.setAttribute('data-lang','Code'),c.className='language-code'),(!a||d)&&wrap(b.parentNode,c)}):null})(),langCodeElem=document.querySelectorAll('.language-code'),langCodeElem?langCodeElem.forEach(function(b){var a=document.createElement('span');a.className='copy-to-clipboard',a.setAttribute('title','Copy to clipboard'),b.append(a)}):null,dollarCodeElem=document.querySelectorAll('div.language-\\$'),gtCodeElem=document.querySelectorAll('div.language-\\>'),dollarCodeElem?dollarCodeElem.forEach(function(a){var b=a.parentNode.parentNode?a.parentNode.parentNode.querySelectorAll('.lnt'):null;b?b.forEach(function(a){a.innerHTML='$<br/>'}):null}):null,gtCodeElem?gtCodeElem.forEach(function(a){var b=a.parentNode.parentNode?a.parentNode.parentNode.querySelectorAll('.lnt'):null;b?b.forEach(function(a){a.innerHTML='><br/>'}):null}):null</script>
<div class=donation>
<div class=donation__message>
Share on
</div>
<div class=donation__icons>
<a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdotleo.cn%2fposts%2fio%25E6%25A8%25A1%25E5%259E%258B%25E8%25AF%25A6%25E8%25A7%25A3%2f" title=Facebook aria-label="Facebook Share Button" class=donation__item target=_blank rel=noreferrer data-type=share><svg data-name="facebook" enable-background="new 0 0 24 24" viewBox="0 0 24 24" width="35" height="35" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path d="m15.997 3.985h2.191V.169c-.378-.052-1.678-.169-3.192-.169-3.159.0-5.323 1.987-5.323 5.639V9H6.187v4.266h3.486V24h4.274V13.267h3.345l.531-4.266h-3.877V6.062c.001-1.233.333-2.077 2.051-2.077z"/></svg>
</a>
<a href="https://twitter.com/intent/tweet?text=IO%20%e6%a8%a1%e5%9e%8b%e8%af%a6%e8%a7%a3&url=https%3a%2f%2fdotleo.cn%2fposts%2fio%25E6%25A8%25A1%25E5%259E%258B%25E8%25AF%25A6%25E8%25A7%25A3%2f&hashtags=IO%2cLinux%2cNIO%2cJava&via=dotleo" title=Twitter aria-label="Twitter Share Button" class=donation__item target=_blank rel=noreferrer data-type=share><svg data-name="twitter" enable-background="new 0 0 24 24" viewBox="0 0 24 24" width="35" height="35" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path d="m21.534 7.113C22.51 6.42 23.331 5.555 24 4.559v-.001c-.893.391-1.843.651-2.835.777 1.02-.609 1.799-1.566 2.165-2.719-.951.567-2.001.967-3.12 1.191-.903-.962-2.19-1.557-3.594-1.557-2.724.0-4.917 2.211-4.917 4.921.0.39.033.765.114 1.122-4.09-.2-7.71-2.16-10.142-5.147-.424.737-.674 1.58-.674 2.487.0 1.704.877 3.214 2.186 4.089-.791-.015-1.566-.245-2.223-.606v.054c0 2.391 1.705 4.377 3.942 4.835-.401.11-.837.162-1.29.162-.315.0-.633-.018-.931-.084.637 1.948 2.447 3.381 4.597 3.428-1.674 1.309-3.8 2.098-6.101 2.098-.403.0-.79-.018-1.177-.067 2.18 1.405 4.762 2.208 7.548 2.208 8.683.0 14.342-7.244 13.986-14.637z"/></svg>
</a>
</div>
</div>
<section class=related>
</section>
<div class=grow></div>
<nav class=pagination-single>
<a href=https://dotleo.cn/posts/tmux-cheatsheet/ class=pagination-single__left>
<div class=pagination-single__icon><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentcolor" d="M19 11H7.83l4.88-4.88c.39-.39.39-1.03.0-1.42s-1.02-.39-1.41.0l-6.59 6.59c-.39.39-.39 1.02.0 1.41l6.59 6.59c.39.39 1.02.39 1.41.0s.39-1.02.0-1.41L7.83 13H19c.55.0 1-.45 1-1s-.45-1-1-1z"/></svg>
</div>
<div class=pagination-single__left-title>[Reproduce] Tmux Cheatsheet</div>
</a>
<div class=grow></div>
</nav>
<div id=utterances></div>
<noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript>
<script>document.addEventListener('DOMContentLoaded',function(){var b,c,d,e,f,a;function g(b,c){var a=b||c;return a==="dark"?"photon-dark":a==="hacker"?"photon-dark":a==="kimbie"?"github-dark-orange":"github-light"}try{b=JSON.parse('"lfdotleo"'),c=JSON.parse('"lfdotleo.github.io"'),d=JSON.parse('"light"'),e=localStorage.getItem('theme'),f=g(e,d),a=document.createElement('script'),a.setAttribute('src','https://utteranc.es/client.js'),a.setAttribute('repo',`${b}/${c}`),a.setAttribute('issue-term','pathname'),a.setAttribute('theme',f),a.setAttribute('crossorigin','anonymous'),a.setAttribute('async',''),a.onload=function(){},document.getElementById('utterances').appendChild(a)}catch(a){console.log(a)}})</script>
<div id=comments-fallback class=viaemail>
<div class=utterances__message>
<a href=https://github.com/lfdotleo/lfdotleo.github.io/issues/ target=_blank rel=noreferrer>&nbsp;</a>
</div>
</div>
<div class="modal micromodal-slide" id=modal aria-hidden=true>
<div class=modal__overlay tabindex=-1 data-micromodal-close>
<div class=modal__container role=dialog aria-modal=true aria-labelledby=modal-title>
<div class=modal__content id=modal-content>
<div id=mySwipe class=swipe>
<div class=swipe-wrap>
</div>
</div>
</div>
<span class=modal__items>
<span class=modal__header>
<div class=modal__paging title="Page Info" aria-label="Current Page">
</div>
<div class="modal__icon modal__toolbar modal__toolbar--close" title=Close aria-label="Close Button" data-micromodal-close><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" width="25" height="25"><path fill="currentcolor" d="M21.734375 19.640625l-2.097656 2.09375C19.253906 22.121094 18.628906 22.121094 18.242188 21.734375L13 16.496094 7.761719 21.734375C7.375 22.121094 6.746094 22.121094 6.363281 21.734375l-2.097656-2.09375c-.386719-.386718999999999-.386719-1.011719.0-1.398437L9.503906 13 4.265625 7.761719c-.382812-.390625-.382812-1.019531.0-1.398438L6.363281 4.265625C6.746094 3.878906 7.375 3.878906 7.761719 4.265625L13 9.507813l5.242188-5.242188c.386718000000002-.386719 1.015625-.386719 1.394531.0l2.097656 2.09375C22.121094 6.746094 22.121094 7.375 21.738281 7.761719L16.496094 13l5.238281 5.242188C22.121094 18.628906 22.121094 19.253906 21.734375 19.640625z"/></svg>
</div>
<div class="modal__icon modal__toolbar modal__toolbar--full" title="Full Screen" aria-label="Full Screen Button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="25" height="25"><path fill="currentcolor" d="M5 3C3.9069372 3 3 3.9069372 3 5V8A1.0001 1.0001.0 105 8V5H8A1.0001 1.0001.0 108 3H5zM16 3a1.0001 1.0001.0 100 2h3V8a1.0001 1.0001.0 102 0V5C21 3.9069372 20.093063 3 19 3H16zM3.984375 14.986328A1.0001 1.0001.0 003 16v3c0 1.093063.9069372 2 2 2H8a1.0001 1.0001.0 100-2H5V16A1.0001 1.0001.0 003.984375 14.986328zm16 0A1.0001 1.0001.0 0019 16v3H16a1.0001 1.0001.0 100 2h3C20.093063 21 21 20.093063 21 19V16a1.0001 1.0001.0 00-1.015625-1.013672z"/></svg>
</div>
<div class="modal__icon modal__toolbar modal__toolbar--normal" title="Normal Screen" aria-label="Normal Screen Button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="25" height="25"><path fill="currentcolor" d="M16.96875 4.972656C15.867188 4.988281 14.984375 5.894531 15 7v8H7C6.277344 14.988281 5.609375 15.367188 5.246094 15.992188 4.878906 16.613281 4.878906 17.386719 5.246094 18.007813 5.609375 18.632813 6.277344 19.011719 7 19H19V7C19.007813 6.460938 18.796875 5.941406 18.414063 5.558594 18.03125 5.175781 17.511719 4.964844 16.96875 4.972656zm16 0c-1.046875.015625-1.90625.839844-1.964844 1.886719C31 6.90625 31 6.953125 31 7V19H43C43.066406 19 43.132813 19 43.199219 18.992188 44.269531 18.894531 45.070313 17.972656 45.015625 16.902344 44.964844 15.828125 44.074219 14.988281 43 15H35V7C35.007813 6.460938 34.796875 5.941406 34.414063 5.558594 34.03125 5.175781 33.511719 4.964844 32.96875 4.972656zM7 31C6.277344 30.988281 5.609375 31.367188 5.246094 31.992188 4.878906 32.613281 4.878906 33.386719 5.246094 34.007813 5.609375 34.632813 6.277344 35.011719 7 35h8v8C14.988281 43.722656 15.367188 44.390625 15.992188 44.753906 16.613281 45.121094 17.386719 45.121094 18.007813 44.753906 18.632813 44.390625 19.011719 43.722656 19 43V31zm24 0V43C30.988281 43.722656 31.367188 44.390625 31.992188 44.753906 32.613281 45.121094 33.386719 45.121094 34.007813 44.753906 34.632813 44.390625 35.011719 43.722656 35 43V35h8C43.722656 35.011719 44.390625 34.632813 44.753906 34.007813 45.121094 33.386719 45.121094 32.613281 44.753906 31.992188 44.390625 31.367188 43.722656 30.988281 43 31z"/></svg>
</div>
</span>
<div class="modal__icon modal__arrow modal__arrow--left" title="Arrow Left" aria-label="Arrow Left Button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" width="28" height="28"><path fill="currentcolor" d="M23.28125 11 10 10V6.851563C10 6.523438 9.839844 6.277344 9.519531 6.03125 9.199219 5.949219 8.878906 5.949219 8.640625 6.113281c-3.28125 2.296875-6.402344 6.144532-6.480469 6.308594-.078125.15625-.152343.390625-.15625.554688000000001C2.003906 12.980469 2 12.988281 2 12.992188 2 13.15625 2.078125 13.402344 2.160156 13.484375 2.238281 13.648438 5.28125 17.507813 8.640625 19.804688 8.960938 19.96875 9.28125 20.050781 9.519531 19.886719 9.839844 19.722656 10 19.476563 10 19.148438V16l13.28125-1C23.679688 14.679688 24 13.875 24 12.992188 24 12.195313 23.761719 11.320313 23.28125 11z"/></svg>
</div>
<div class="modal__icon modal__arrow modal__arrow--right" title="Arrow Right" aria-label="Arrow Right Button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" width="28" height="28"><path fill="currentcolor" d="M2.71875 11.023438l13.28125-1V6.875C16 6.546875 16.160156 6.300781 16.480469 6.054688 16.800781 5.972656 17.121094 5.972656 17.359375 6.136719c3.28125 2.296875 6.402344 6.144531 6.480469 6.308594.078125.15625.152343999999999.390625.15625.554687C23.996094 13.003906 24 13.011719 24 13.015625 24 13.179688 23.921875 13.425781 23.839844 13.507813 23.761719 13.671875 20.71875 17.53125 17.359375 19.828125 17.039063 19.992188 16.71875 20.074219 16.480469 19.910156 16.160156 19.746094 16 19.5 16 19.171875V16.023438L2.71875 15.023438C2.320313 14.703125 2 13.898438 2 13.015625c0-.796875.238281-1.671875.71875-1.992187z"/></svg>
</div>
<div class=modal__caption>
<div class=modal__caption--text>
</div>
</div>
</span>
</div>
</div>
</div>
<script defer src=/js/swipe.min.989e074dfb92ce7f57a92c1df7027f88b53c50a54fd9ad450a673a64aa91bfa4.js></script>
<script defer src=/js/micromodal.min.de01b44b2f383056bbcaf6ee921fd385d79108ec1129afd0eb2f3f5a07e11f45.js></script>
<script defer src=/js/helper/fadeinout.min.js></script>
<script>document.addEventListener('DOMContentLoaded',function(){var d=document.documentElement,g,f,s,r,m,o,l,b,c,i,n,e,h,j,a,p,q;function t(){d.requestFullscreen?d.requestFullscreen():d.mozRequestFullScreen?d.mozRequestFullScreen():d.webkitRequestFullscreen?d.webkitRequestFullscreen():d.msRequestFullscreen&&d.msRequestFullscreen()}function k(){(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen())}g=document.getElementById('modal'),f=document.querySelector('.gallery__container'),s=document.querySelector('.swipe-wrap'),r=document.getElementById('mySwipe'),m=document.querySelector('.modal__arrow--left'),o=document.querySelector('.modal__arrow--right'),l=document.querySelector('.modal__toolbar--close'),b=document.querySelector('.modal__toolbar--full'),c=document.querySelector('.modal__toolbar--normal'),i=document.querySelector('.modal__caption'),n=document.querySelector('.modal__paging'),e=document.querySelector('.modal__items'),h=null,j=null,a=null,p=function(b){b.key==='ArrowRight'?g&&g.classList.contains('is-open')&&a.next():b.key==='ArrowLeft'&&g&&g.classList.contains('is-open')&&a.prev()},f?h=f.querySelectorAll('img').length:(f=document.querySelector('.single__contents'),h=f.querySelectorAll('img').length),MicroModal.init({onClose:function(){a&&(a.kill(),a=null,k()),window.removeEventListener('keydown',p)},disableScroll:!0,disableFocus:!0,awaitOpenAnimation:!1,awaitCloseAnimation:!1,debugMode:!1}),q=function(a){return new Promise(function(c,d){var b=new Image;b.onload=function(){c(b)},b.onerror=d,b.src=a})},f.querySelectorAll('img').forEach(function(g,k){var f,d;g.style.cursor='pointer',f=g.cloneNode(!0),f.style.maxHeight='100%',f.style.maxWidth='100%',f.onclick=function(a){a.stopPropagation()},d=document.createElement('div'),d.style.width='100%',d.style.height='100vh',d.setAttribute('data-micromodal-close',''),d.onclick=function(){a&&(a.kill(),a=null)},d.onmouseenter=function(){clearTimeout(j),fadeIn(e,200)},d.onmouseleave=function(){j=setTimeout(function(){fadeOut(e,200)},2500)},d.ontouchstart=function(){fadeIn(e,200)},d.append(f),s.append(d),g.addEventListener('click',async function(d){var m,l,g;MicroModal.show('modal'),a&&(a.kill(),a=null),m=d.target.getAttribute('data-src')||d.target.getAttribute('src'),l=await q(m),f.style.width=l.width+'px',f.style.height=l.height+'px',a=new Swipe(r,{startSlide:k,draggable:!0,autoRestart:!1,continuous:!1,disableScroll:!0,stopPropagation:!0,callback:async function(d,f){var a=f.querySelector('img'),g=a.getAttribute('data-src')||a.getAttribute('src'),c=await q(g),b;a.style.width=c.width+'px',a.style.height=c.height+'px',i&&a&&(b=null,a.getAttribute('data-caption')?b=a.getAttribute('data-caption'):a.getAttribute('title')?b=a.getAttribute('title'):a.getAttribute('alt')?b=a.getAttribute('alt'):b=a.getAttribute('src'),i.querySelector('.modal__caption--text').innerText=b,n.innerText=d+1+' / '+h,clearTimeout(j),fadeIn(e,200))}}),fadeIn(e),i&&(g=null,d.target.getAttribute('data-caption')?g=d.target.getAttribute('data-caption'):d.target.getAttribute('title')?g=d.target.getAttribute('title'):d.target.getAttribute('alt')?g=d.target.getAttribute('alt'):g=d.target.getAttribute('src'),i.querySelector('.modal__caption--text').innerText=g,n.innerText=k+1+' / '+h),c&&b&&(c.style.zIndex=-1,c.style.opacity=0,b.style.zIndex=25,b.style.opacity=1)}),window.addEventListener('keydown',p)}),m?m.addEventListener('click',function(b){a&&a.prev()}):null,o?o.addEventListener('click',function(b){a&&a.next()}):null,l?l.addEventListener('click',function(){a&&(a.kill(),a=null),k(),MicroModal.close('modal')}):null,b?b.addEventListener('click',function(a){t(),c&&(c.style.zIndex=25,c.style.opacity=1,b.style.zIndex=-1,b.style.opacity=0)}):null,c?c.addEventListener('click',function(a){k(),b&&(b.style.zIndex=25,b.style.opacity=1,c.style.zIndex=-1,c.style.opacity=0)}):null})</script>
<div class=hide>
<div class=search>
<span class=icon><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentcolor" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49.0s.41-1.08.0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
</span>
<input id=search aria-label="Site Search" class=input type=text placeholder=Search autocomplete=off>
<div id=search-results class=dropdown>
<div id=search-menu class=dropdown-menu role=menu>
</div>
</div>
</div>
</div>
</div>
</main>
<aside class="single__side main-side">
<section class="sidebar hide">
<script>document.querySelector('.sidebar').classList.remove('hide')</script>
<div class=toc__flexbox data-position=fixed>
<h6 class=toc__title data-ani=true>What's on this Page</h6>
<label class=switch data-ani=true>
<input id=toggle-toc aria-label="Toggle TOC" type=checkbox checked>
<span class="slider round"></span>
</label>
</div>
<div class=toc data-dir=ltr data-folding=true data-ani=true>
<nav id=TableOfContents>
<ul>
<li><a href=#系统调用>系统调用</a></li>
<li><a href=#学会查看文件描述符>学会查看文件描述符</a></li>
<li><a href=#bio>BIO</a></li>
<li><a href=#nio非阻塞-io>NIO（非阻塞 IO)</a></li>
<li><a href=#多路复用>多路复用</a>
<ul>
<li><a href=#select>select</a></li>
<li><a href=#poll>poll</a></li>
<li><a href=#epoll>epoll</a>
<ul>
<li><a href=#epoll_create>epoll_create</a></li>
<li><a href=#epoll_ctl>epoll_ctl</a></li>
<li><a href=#epoll_wait>epoll_wait</a></li>
<li><a href=#边缘触发和水平触发>边缘触发和水平触发</a></li>
</ul>
</li>
</ul>
</li>
<li><a href=#总结>总结</a>
<ul>
<li><a href=#第一种理解思路>第一种理解思路</a></li>
<li><a href=#第二种理解思路>第二种理解思路</a></li>
</ul>
</li>
<li><a href=#参考内容>参考内容</a></li>
</ul>
</nav>
</div>
</section>
</aside>
<script>var enableToc=JSON.parse("true"),toc=JSON.parse("null"),tocPosition=JSON.parse('"inner"'),singleMainElem=document.querySelector('.single__main'),singleSideElem=document.querySelector('.single__side');enquire.register("screen and (max-width: 769px)",{match:function(){(enableToc||toc)&&tocPosition!=="outer"?singleMainElem&&singleSideElem&&(singleMainElem.classList.remove('main-main'),singleMainElem.classList.add('main'),singleSideElem.classList.remove('main-side'),singleSideElem.classList.add('hide')):tocPosition==="outer"&&(singleMainElem&&!singleMainElem.classList.contains('main-main')&&(singleMainElem.classList.remove('main-main'),singleMainElem.classList.add('main')),singleSideElem&&!singleSideElem.classList.contains('hide')&&singleSideElem.classList.add('hide'))},unmatch:function(){var b,a;(enableToc||toc)&&tocPosition!=="outer"?(singleMainElem.classList.remove('main'),singleMainElem.classList.add('main-main'),singleSideElem.classList.remove('hide'),singleSideElem.classList.add('main-side')):tocPosition==="outer"&&(singleMainElem&&!singleMainElem.classList.contains('main-main')&&(singleMainElem.classList.remove('main-main'),singleMainElem.classList.add('main')),singleSideElem&&!singleSideElem.classList.contains('hide')&&singleSideElem.classList.add('hide')),b=document.querySelector('.navbar__burger'),a=document.getElementsByClassName('navbarm__collapse')[0],a&&(a.setAttribute('data-open',!1),a.style.maxHeight=0,b.classList.remove('is-active')),document.getElementsByClassName('navbar__menu')[0].classList.remove('is-active'),document.getElementsByClassName('mobile-search')[0].classList.add('hide')},setup:function(){},deferSetup:!0,destroy:function(){}})</script>
<script defer src=/js/helper/getParents.min.js></script>
<script defer src=/js/helper/closest.min.js></script>
<script defer src=/js/helper/prev.min.js></script>
<script defer src=/js/helper/prop.min.js></script>
<script defer src=/js/helper/fadeinout.min.js></script>
<script defer src=/js/helper/throttle.min.js></script>
<script>'use strict';window.onload=function(){var f=document.querySelector('.navbar'),D=document.querySelector('.single__contents'),E=JSON.parse("true"),J=JSON.parse("true"),s,H,F,L,k,j,A,g,u,x,d,e,l,i,I,C,K,v,N,y,r,z,b,w,t,M,h,c,G,a,m,n,o,p,B,q;E&&J&&(s=document.querySelector('#busuanzi_value_page_pv'),s.textContent=s.textContent.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")),H=JSON.parse("true"),F=JSON.parse("null"),L=JSON.parse("false"),k=document.querySelector('.toc__flexbox'),j=document.querySelector('.toc__flexbox--outer'),A=JSON.parse("true"),(H||F)&&document.querySelector('.toc')&&(g=document.querySelector('.toc').querySelector('#TableOfContents'),g.onmouseenter=function(){f.classList.contains('scrolling')&&f.classList.remove('scrolling')},g.onmouseleave=function(){f.classList.contains('scrolling')||f.classList.add('scrolling')},!1===A||(g.querySelectorAll('ul')?g.querySelectorAll('ul').forEach(function(a){a.querySelectorAll('li').forEach(function(a){a.querySelectorAll('ul').forEach(function(a){a.style.display='none'})})}):null),g&&(g.querySelectorAll('a').length>0?g.querySelectorAll('a').forEach(function(a){a.addEventListener('click',function(){var c=a.getAttribute('id'),b;f.classList.contains('scrolling')||(f.classList.remove('navbar--show'),f.classList.remove('navbar--hide'),f.classList.add('navbar--hide')),document.querySelector('.toc').querySelectorAll('a').forEach(function(a){a.classList.remove('active')}),a.classList.add('active'),b=g.querySelector('[href="#'+c+'"]'),b&&b.nextElementSibling&&(b.nextElementSibling.style.display='block'),b&&(getParents(b,'ul')?getParents(b,'ul').forEach(function(a){a.style.display='block'}):null)})}):(k&&(k.setAttribute('data-position',''),k.classList.contains('hide')||k.classList.add('hide')),j&&(j.setAttribute('data-position',''),j.classList.contains('hide')||j.classList.add('hide')))),u=document.getElementById("toggle-toc"),x=document.getElementById('visible-toc'),d=document.querySelector('.toc'),e=document.querySelector('main'),l=document.querySelector('side'),i=document.querySelector('.toc__flexbox'),u?u.addEventListener('change',function(a){a.target.checked?(d&&fadeIn(d,200),i&&i.setAttribute('data-position','fixed'),e&&(e.classList.remove('main-main'),e.classList.remove('main'),e.classList.add('main-main')),l&&l.classList.remove('main-side')):(d&&fadeOut(d,200),i&&i.setAttribute('data-position','absolute'),e&&(e.classList.remove('main-main'),e.classList.remove('main'),e.classList.add('main')),l&&l.classList.remove('main-side'))}):null,x?x.addEventListener('change',function(a){a.target.checked?d&&fadeIn(d,200):d&&fadeOut(d,200)}):null),I=120,C=70,K=function(){d&&(d.style.maxHeight=window.innerHeight-I-C+'px')},v=throttle(K,300),v(),window.addEventListener('resize',v),y=new ClipboardJS('.anchor'),r=D.querySelectorAll("h1, h2, h3, h4"),z=JSON.parse('"ltr"'),r?r.forEach(function(c){var d=parseInt(c.tagName.substr(1),10)*2,e=encodeURI(document.location.origin+document.location.pathname),f=e+"#"+c.getAttribute('id'),b=document.createElement('span'),a;b.classList.add('anchor'),b.classList.add('hide'),b.setAttribute('data-clipboard-text',decodeURI(f)),b.style.position='relative',a=document.createElement('span'),a.style.position='absolute',a.style.top='50%',a.style.left='0.75rem',a.style.transform='translateY(-50%)',a.innerHTML=`
<svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="${32-d}px" height="${32-d}px"><path d="M 5.5625 0 C 4.136719 0 2.707031 0.542969 1.625 1.625 C -0.539063 3.789063 -0.539063 7.335938 1.625 9.5 L 5.28125 13.15625 C 5.667969 13.554688 6.304688 13.558594 6.703125 13.171875 C 7.101563 12.785156 7.105469 12.148438 6.71875 11.75 L 3.03125 8.0625 C 1.632813 6.664063 1.632813 4.429688 3.03125 3.03125 C 4.429688 1.632813 6.664063 1.632813 8.0625 3.03125 L 12.96875 7.9375 C 14.367188 9.335938 14.367188 11.570313 12.96875 12.96875 C 12.804688 13.132813 12.621094 13.25 12.4375 13.375 C 11.980469 13.6875 11.859375 14.308594 12.171875 14.765625 C 12.484375 15.222656 13.105469 15.34375 13.5625 15.03125 C 13.847656 14.835938 14.125 14.625 14.375 14.375 C 16.539063 12.210938 16.539063 8.664063 14.375 6.5 L 9.5 1.625 C 8.417969 0.542969 6.988281 0 5.5625 0 Z M 10.78125 8.875 C 10.738281 8.882813 10.695313 8.894531 10.65625 8.90625 C 10.507813 8.9375 10.371094 9 10.25 9.09375 C 10.039063 9.253906 9.820313 9.429688 9.625 9.625 C 7.460938 11.789063 7.460938 15.335938 9.625 17.5 L 14.5 22.375 C 16.664063 24.539063 20.210938 24.539063 22.375 22.375 C 24.539063 20.210938 24.539063 16.664063 22.375 14.5 L 18.71875 10.875 C 18.476563 10.578125 18.089844 10.441406 17.714844 10.527344 C 17.34375 10.613281 17.050781 10.90625 16.964844 11.277344 C 16.878906 11.652344 17.015625 12.039063 17.3125 12.28125 L 20.96875 15.9375 C 22.367188 17.335938 22.367188 19.570313 20.96875 20.96875 C 19.570313 22.367188 17.335938 22.367188 15.9375 20.96875 L 11.03125 16.0625 C 9.632813 14.664063 9.632813 12.429688 11.03125 11.03125 C 11.152344 10.90625 11.300781 10.820313 11.4375 10.71875 C 11.839844 10.472656 12.015625 9.976563 11.855469 9.53125 C 11.699219 9.085938 11.25 8.8125 10.78125 8.875 Z"/></svg>`,z==="rtl"?a.style.left='-2rem':a.style.right='-2rem',b.append(a),c.append(b),c.addEventListener('mouseenter',function(){this.querySelector('.anchor').classList.remove('hide')}),c.addEventListener('mouseleave',function(){this.querySelector('.anchor').classList.add('hide')})}):null,document.querySelectorAll('.anchor').forEach(function(a){a.addEventListener('mouseleave',function(){a.setAttribute('aria-label',null),a.classList.remove('tooltipped'),a.classList.remove('tooltipped-s'),a.classList.remove('tooltipped-w')})}),y.on('success',function(a){a.clearSelection(),a.trigger.setAttribute('aria-label','Link copied to clipboard!'),a.trigger.classList.add('tooltipped'),a.trigger.classList.add('tooltipped-s')}),b=JSON.parse("null"),b&&b.includes('mermaid')&&(w=localStorage.getItem('theme')||JSON.parse('"light"'),w==="dark"||w==="hacker"?mermaid.initialize({theme:'dark'}):mermaid.initialize({theme:'default'}),t=[],[].push.apply(t,document.getElementsByClassName('language-mermaid')),t.forEach(function(b){var a=b.parentNode,c;a!==document.body&&(a.parentNode.insertBefore(b,a),a.parentNode.removeChild(a)),c=document.createElement('div'),c.classList.add('mermaid'),c.style.padding='34px 4px 6px',c.innerHTML=b.innerHTML,b.replaceWith(c)})),b&&b.includes('katex')&&(M=document.getElementsByClassName('math'),h={delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]},renderMathInElement(document.querySelector('.single__contents'),h)),b&&b.includes('flowchartjs')&&(h=JSON.parse('{"arrow-end":"block","element-color":"black","fill":"white","flowstate":{"approved":{"fill":"#58C4A3","font-size":12,"no-text":"n/a","yes-text":"APPROVED"},"current":{"fill":"yellow","font-color":"red","font-weight":"bold"},"future":{"fill":"#FFFF99"},"invalid":{"fill":"#444444"},"past":{"fill":"#CCCCCC","font-size":12},"rejected":{"fill":"#C45879","font-size":12,"no-text":"REJECTED","yes-text":"n/a"},"request":{"fill":"blue"}},"font-color":"black","font-size":14,"line-color":"black","line-length":50,"line-width":3,"no-text":"no","scale":1,"symbols":{"end":{"class":"end-element"},"start":{"element-color":"green","fill":"yellow","font-color":"red"}},"text-margin":10,"x":0,"y":0,"yes-text":"yes"}'),c=null,G="language-flowchart",a=0,Array.prototype.forEach.call(document.querySelectorAll("[class^="+G+"]"),function(b){var d,e;b.style.display='none',b.parentNode.style.backgroundColor="transparent",c=b.innerText,d=document.createElement('div'),d.id='flowchart'+a,b.parentNode.insertBefore(d,b),e=flowchart.parse(c),e.drawSVG("flowchart"+a,h),a+=1})),document.querySelectorAll("mjx-container").forEach(function(a){a.parentElement.classList+='has-jax'}),b&&b.includes('msc')&&(h=JSON.parse('{"theme":"hand"}'),c=null,a=0,m="language-msc",Array.prototype.forEach.call(document.querySelectorAll("[class^="+m+"]"),function(b){var d,e;b.style.display='none',b.parentNode.style.backgroundColor="transparent",c=b.innerText,d=document.createElement('div'),d.id='msc'+a,b.parentNode.insertBefore(d,b),e=Diagram.parse(c),e.drawSVG("msc"+a,h),a+=1})),b&&b.includes('chart')&&(n="#666",o="#ddd",p=2,Chart.defaults.global.elements.rectangle.borderWidth=p,Chart.defaults.global.elements.rectangle.borderColor=n,Chart.defaults.global.elements.rectangle.backgroundColor=o,Chart.defaults.global.elements.line.borderWidth=p,Chart.defaults.global.elements.line.borderColor=n,Chart.defaults.global.elements.line.backgroundColor=o,Chart.defaults.global.elements.point.borderWidth=p,Chart.defaults.global.elements.point.borderColor=n,Chart.defaults.global.elements.point.backgroundColor=o,m="language-chart",a=0,c=null,Array.prototype.forEach.call(document.querySelectorAll("[class^="+m+"]"),function(b){var d,e,f,g;b.style.display='none',b.parentNode.style.backgroundColor="transparent",c=b.innerText,d=document.createElement('canvas'),e=null,d.height=200,d.style.height=200,d.id='myChart'+a,e=JSON.parse(c),b.parentNode.insertBefore(d,b),f=document.getElementById('myChart'+a).getContext('2d'),g=new Chart(f,e),a+=1})),b&&b.includes('wavedrom')&&(B="language-wave",a=0,c=null,Array.prototype.forEach.call(document.querySelectorAll("[class^="+B+"]"),function(b){var d,e;b.style.display='none',b.parentNode.style.backgroundColor="transparent",c=b.innerText,d=document.createElement('div'),e=null,d.id='WaveDrom_Display_'+a,e=JSON.parse(c),b.parentNode.insertBefore(d,b),WaveDrom.RenderWaveForm(a,e,"WaveDrom_Display_"),a+=1})),b&&b.includes('viz')&&(q="language-viz-",Array.prototype.forEach.call(document.querySelectorAll("[class^="+q+"]"),function(a){var b,c;a.style.display='none',a.parentNode.style.backgroundColor="transparent",a.getAttribute("class").split(" ").forEach(function(a){a.startsWith(q)&&(b=a.substr(q.length))}),c=new Viz,c.renderSVGElement(a.innerText,{engine:b}).then(function(b){b.style.width="100%",a.parentNode.insertBefore(b,a)})}))}</script>
<footer class=footer>
<div class=footer__social>
<div class=social>
<a href=https://github.com/lfdotleo title=github aria-label=github><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 24 24"><g id="surface3680"><path fill="currentcolor" d="M10.898438 2.101562c-4.597657.5-8.296876 4.199219-8.796876 8.699219-.5 4.699219 2.199219 8.898438 6.296876 10.5C8.699219 21.398438 9 21.199219 9 20.800781V19.199219S8.601562 19.300781 8.101562 19.300781c-1.402343.0-2-1.199219-2.101562-1.902343C5.898438 17 5.699219 16.699219 5.398438 16.398438 5.101562 16.300781 5 16.300781 5 16.199219 5 16 5.300781 16 5.398438 16 6 16 6.5 16.699219 6.699219 17c.5.800781000000001 1.101562 1 1.402343 1C8.5 18 8.800781 17.898438 9 17.800781 9.101562 17.101562 9.398438 16.398438 10 16c-2.300781-.5-4-1.800781-4-4 0-1.101562.5-2.199219 1.199219-3C7.101562 8.800781 7 8.300781 7 7.601562c0-.402343.0-1 .300781-1.601562.0.0 1.398438.0 2.800781 1.300781C10.601562 7.101562 11.300781 7 12 7s1.398438.101562 2 .300781C15.300781 6 16.800781 6 16.800781 6 17 6.601562 17 7.199219 17 7.601562 17 8.398438 16.898438 8.800781 16.800781 9 17.5 9.800781 18 10.800781 18 12c0 2.199219-1.699219 3.5-4 4 .601562.5 1 1.398438 1 2.300781v2.597657C15 21.199219 15.300781 21.5 15.699219 21.398438 19.398438 19.898438 22 16.300781 22 12.101562c0-6-5.101562-10.703124-11.101562-10zm0 0"/></g></svg>
</a>
<a href=https://dotleo.cn/posts/index.xml type=application/rss+xml title=RSS aria-label="RSS Feed Link"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><circle fill="currentcolor" cx="6.18" cy="17.82" r="2.18"/><path fill="currentcolor" d="M5.59 10.23c-.84-.14-1.59.55-1.59 1.4.0.71.53 1.28 1.23 1.4 2.92.51 5.22 2.82 5.74 5.74.12.7.69 1.23 1.4 1.23.85.0 1.54-.75 1.41-1.59-.68-4.2-3.99-7.51-8.19-8.18zm-.03-5.71C4.73 4.43 4 5.1 4 5.93c0 .73.55 1.33 1.27 1.4 6.01.6 10.79 5.38 11.39 11.39.07.73.67 1.28 1.4 1.28.84.0 1.5-.73 1.42-1.56-.73-7.34-6.57-13.19-13.92-13.92z"/></svg>
</a>
</div>
</div>
<div id=gtt>
<div class=gtt><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentcolor" d="M8.12 14.71 12 10.83l3.88 3.88c.39.39 1.02.39 1.41.0s.39-1.02.0-1.41L12.7 8.71c-.39-.39-1.02-.39-1.41.0L6.7 13.3c-.39.39-.39 1.02.0 1.41.39.38 1.03.39 1.42.0z"/></svg>
</div>
</div>
<hr>
<div class="basicflex flexwrap">
</div>
<div class=footer__poweredby>
<div class=busuanzi>
<div class=busuanzi__item>
<span class=busuanzi__item--label>
Total visitors
</span>
<span id=busuanzi_value_site_uv class=busuanzi__item--number>...</span>
</div>
<div class=busuanzi__item>
<span class=busuanzi__item--label>
Total views
</span>
<span id=busuanzi_value_site_pv class=busuanzi__item--number>...</span>
</div>
</div>
<p class=caption>
©2021, All Rights Reserved
</p>
<p class=caption>Powered by <a href=https://gohugo.io/ target=_blank rel=noreferrer>Hugo</a> and the <a href=https://github.com/zzossig/hugo-theme-zzo target=_blank rel=noreferrer>Zzo theme</a></p>
</div>
</footer>
</div>
<div class="wrapper__right hide" data-pad=true dir=ltr>
<script>document.querySelector('.wrapper__right').classList.remove('hide')</script>
</div>
</div>
</body>
</html>